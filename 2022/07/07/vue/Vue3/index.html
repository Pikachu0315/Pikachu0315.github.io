<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><div id="myscoll"></div><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Vue 3.0 | 我不是皮卡丘i</title><meta name="keywords" content="Vue3"><meta name="author" content="Pikachu"><meta name="copyright" content="Pikachu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="vue3 简介  2020 年 9 月 18 日，Vue.js 发布 3.0 版本，代号：One Piece（海贼王） 耗时 2 年多、2600+次提交、30+个 RFC、600+次 PR、99 位贡献者 github 上的 tags 地址：https:&#x2F;&#x2F;github.com&#x2F;vuejs&#x2F;vue-next&#x2F;releases&#x2F;tag&#x2F;v3.0.0  Vue3 带来了什么 性能的提升  打包大小减少">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue 3.0">
<meta property="og:url" content="https://pikachu0315.github.io/2022/07/07/vue/Vue3/index.html">
<meta property="og:site_name" content="我不是皮卡丘i">
<meta property="og:description" content="vue3 简介  2020 年 9 月 18 日，Vue.js 发布 3.0 版本，代号：One Piece（海贼王） 耗时 2 年多、2600+次提交、30+个 RFC、600+次 PR、99 位贡献者 github 上的 tags 地址：https:&#x2F;&#x2F;github.com&#x2F;vuejs&#x2F;vue-next&#x2F;releases&#x2F;tag&#x2F;v3.0.0  Vue3 带来了什么 性能的提升  打包大小减少">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pikachu0315.github.io/img/md/v3.jpg">
<meta property="article:published_time" content="2022-07-07T09:38:41.000Z">
<meta property="article:modified_time" content="2023-03-28T03:50:15.668Z">
<meta property="article:author" content="Pikachu">
<meta property="article:tag" content="Vue3">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pikachu0315.github.io/img/md/v3.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://pikachu0315.github.io/2022/07/07/vue/Vue3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/pluginsSrc/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Pikachu","link":"链接: ","source":"来源: 我不是皮卡丘i","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: '/pluginsSrc/flickr-justified-gallery/dist/fjGallery.min.js',
      css: '/pluginsSrc/flickr-justified-gallery/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Vue 3.0',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-28 11:50:15'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/loading_wizard.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/cat.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><a href="javascript:void(0);" onclick="preloader.endLoading();" title="点击跳过动画"><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="wizard-scene"><div class="wizard-objects"><div class="wizard-square"></div><div class="wizard-circle"></div><div class="wizard-triangle"></div></div><div class="wizard"><div class="wizard-body"></div><div class="wizard-right-arm"><div class="wizard-right-hand"></div></div><div class="wizard-left-arm"><div class="wizard-left-hand"></div></div><div class="wizard-head"><div class="wizard-beard"></div><div class="wizard-face"><div class="wizard-adds"></div></div><div class="wizard-hat"><div class="wizard-hat-of-the-hat"></div><div class="wizard-four-point-star --first"></div><div class="wizard-four-point-star --second"></div><div class="wizard-four-point-star --third"></div></div></div></div></div></div></a><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/head_portrait.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-compass"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/gallery/"><i class="fa-fw fa-fw fas fa-images"></i><span> 相册</span></a></li><li><a class="site-page child" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></li><li><a class="site-page child" href="/myself/"><i class="fa-fw fa fa-id-card"></i><span> myself</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于me</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/md/v3.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">我不是皮卡丘i</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-compass"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/gallery/"><i class="fa-fw fa-fw fas fa-images"></i><span> 相册</span></a></li><li><a class="site-page child" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></li><li><a class="site-page child" href="/myself/"><i class="fa-fw fa fa-id-card"></i><span> myself</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于me</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Vue 3.0</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-07-07T09:38:41.000Z" title="发表于 2022-07-07 17:38:41">2022-07-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-28T03:50:15.668Z" title="更新于 2023-03-28 11:50:15">2023-03-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Vue3/">Vue3</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">13.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>55分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Vue 3.0"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="vue3-简介"><a href="#vue3-简介" class="headerlink" title="vue3 简介"></a>vue3 简介</h1><p><img src="/img/md/v3_1.png"></p>
<ul>
<li>2020 年 9 月 18 日，Vue.js 发布 3.0 版本，代号：One Piece（海贼王）</li>
<li>耗时 2 年多、<a target="_blank" rel="noopener" href="https://github.com/vuejs/core/graphs/commit-activity">2600+次提交</a>、<a target="_blank" rel="noopener" href="https://github.com/vuejs/rfcs/tree/master/active-rfcs">30+个 RFC</a>、<a target="_blank" rel="noopener" href="https://github.com/vuejs/core/pulls?q=is:pr+is:merged+-author:app/dependabot-preview+">600+次 PR</a>、<a target="_blank" rel="noopener" href="https://github.com/vuejs/core/graphs/contributors">99 位贡献者</a></li>
<li>github 上的 tags 地址：<a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-next/releases/tag/v3.0.0">https://github.com/vuejs/vue-next/releases/tag/v3.0.0</a></li>
</ul>
<h1 id="Vue3-带来了什么"><a href="#Vue3-带来了什么" class="headerlink" title="Vue3 带来了什么"></a>Vue3 带来了什么</h1><ol>
<li><p>性能的提升</p>
<ul>
<li>打包大小减少 41%</li>
<li>初次渲染快 55%, 更新渲染快 133%</li>
<li>内存减少 54%</li>
</ul>
</li>
<li><p>源码的升级</p>
</li>
</ol>
<ul>
<li>使用 Proxy 代替 defineProperty 实现响应式</li>
<li>重写虚拟 DOM 的实现和 Tree-Shaking</li>
</ul>
<ol start="3">
<li><p>拥抱 TypeScript</p>
<ul>
<li>Vue3 可以更好的支持 TypeScript</li>
</ul>
</li>
<li><p>新的特性</p>
<ol>
<li><p>Composition API（组合 API）</p>
<ul>
<li>setup 配置</li>
<li>ref 与 reactive</li>
<li>watch 与 watchEffect</li>
<li>provide 与 inject</li>
<li>…</li>
</ul>
</li>
<li><p>新的内置组件</p>
<ul>
<li>Fragment</li>
<li>Teleport</li>
<li>Suspense</li>
</ul>
</li>
<li><p>其他改变</p>
<ul>
<li>新的生命周期钩子</li>
<li>data 选项应始终被声明为一个函数</li>
<li>移除 keyCode 支持作为 v-on 的修饰符</li>
<li>…</li>
</ul>
</li>
</ol>
</li>
</ol>
<h1 id="创建-vue3-项目"><a href="#创建-vue3-项目" class="headerlink" title="创建 vue3 项目"></a>创建 vue3 项目</h1><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">## 查看@vue/cli版本，确保@vue/cli版本在<span class="number">4.5</span><span class="number">.0</span>以上</span><br><span class="line">vue --version</span><br><span class="line">## 安装或者升级你的@vue/cli</span><br><span class="line">npm install -g @vue/cli</span><br><span class="line">## 创建</span><br><span class="line">vue create vue3_study</span><br><span class="line">## 启动</span><br><span class="line">cd vue3_study</span><br><span class="line">npm run serve</span><br></pre></td></tr></table></figure>

<h1 id="Options-API-的弊端"><a href="#Options-API-的弊端" class="headerlink" title="Options API 的弊端"></a>Options API 的弊端</h1><p>在 Vue2 中，我们编写组件的方式是 <strong>OptionsAPI</strong>：</p>
<p>Options API 的一大特点就是在对应的属性中编写对应的功能模块；</p>
<p>比如 data 定义数据、methods 中定义方法、computed 中定义计算属性、watch 中监听属性改变，也包括生命 周期钩子；</p>
<p><strong>但是这种代码有一个很大的弊端</strong>：</p>
<p>当我们实现某一个功能时，这个功能对应的代码逻辑会被拆分到各个属性中；</p>
<p>当我们组件变得更大、更复杂时，逻辑关注点的列表就会增长，那么同一个功能的逻辑就会被拆分的很分散；</p>
<p>尤其对于那些一开始没有编写这些组件的人来说，这个组件的代码是难以阅读和理解的（阅读组件的其他人）；</p>
<p><strong>下面我们来看一个非常大的组件，其中的逻辑功能按照颜色进行了划分</strong>：</p>
<p>这种碎片化的代码使用理解和维护这个复杂的组件变得异常困难，并且隐藏了潜在的逻辑问题；</p>
<p>并且当我们处理单个逻辑关注点时，需要不断的跳到相应的代码块中；</p>
<table>
<thead>
<tr>
<th align="center">OptionsAPI</th>
<th align="center">Composition API</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="/img/md/v3_2.png"></td>
<td align="center"><img src="/img/md/v3_3.png"></td>
</tr>
</tbody></table>
<p>如果我们能将同一个逻辑关注 点相关的代码收集在一起会更好。</p>
<p>这就是<strong>Composition API</strong>想要做的事情，以及可以帮助我 们完成的事情。</p>
<p>也有人把 Vue Composition API 简称为<strong>VCA</strong>。</p>
<h1 id="认识-Composition-API"><a href="#认识-Composition-API" class="headerlink" title="认识 Composition API"></a>认识 Composition API</h1><p>那么既然知道 Composition API 想要帮助我们做什么事情，接下来看一下<strong>到底是怎么做</strong>呢？</p>
<p>为了开始使用 Composition API，我们需要有一个可以实际使用它（编写代码）的地方；</p>
<p>在 Vue 组件中，这个位置就是 setup 函数；</p>
<p><strong>setup</strong>其实就是组件的另外一个选项：</p>
<p>只不过这个选项强大到我们可以用它来替代之前所编写的大部分其他选项；</p>
<p>比如 methods、computed、watch、data、生命周期等等；</p>
<p><strong>接下来我们一起学习这个函数的使用</strong>：</p>
<p>函数的参数</p>
<p>函数的返回值</p>
<h2 id="setup-函数的参数"><a href="#setup-函数的参数" class="headerlink" title="setup 函数的参数"></a>setup 函数的参数</h2><p>我们先来研究一个 setup 函数的参数，它主要有<strong>两个参数</strong>：</p>
<p>第一个参数：props</p>
<p>第二个参数：context</p>
<p>props 非常好理解，它其实就是<strong>父组件传递过来的属性</strong>会被放到 props 对象中，我们在<strong>setup 中如果需要使用</strong>，那么就可以直接通过 props 参数获取：</p>
<p>对于定义 props 的类型，我们还是和之前的规则是一样的，在 props 选项中定义；</p>
<p>并且在 template 中依然是可以正常去使用 props 中的属性，比如 message；</p>
<p>如果我们在 setup 函数中想要使用 props，那么不可以通过 this 去获取（后面我会讲到为什么）；</p>
<p>因为 props 有直接作为参数传递到 setup 函数中，所以我们可以直接通过参数来使用即可；</p>
<p>另外一个参数是<strong>context</strong>，我们也称之为是一个<strong>SetupContext</strong>，它里面包含<strong>三个属性</strong>：</p>
<ul>
<li><strong>attrs</strong>：所有的非 prop 的 attribute；</li>
<li><strong>slots</strong>：父组件传递过来的插槽（这个在以渲染函数返回时会有作用，后面会讲到）；</li>
<li><strong>emit</strong>：当我们组件内部需要发出事件时会用到 emit（因为我们不能访问 this，所以不可以通过 this.$emit 发出事件）；</li>
</ul>
<h2 id="setup-函数的返回值"><a href="#setup-函数的返回值" class="headerlink" title="setup 函数的返回值"></a>setup 函数的返回值</h2><ol>
<li><strong>若返回一个对象，则对象中的属性、方法, 在模板中均可以直接使用。（重点关注！）</strong></li>
<li>若返回一个渲染函数：则可以自定义渲染内容。（了解）</li>
</ol>
<p><strong>注意点：</strong></p>
<ol>
<li><p>尽量不要与 Vue2.x 配置混用</p>
<ul>
<li>Vue2.x 配置（data、methos、computed…）中可以访问到 setup 中的属性、方法。</li>
<li>但在 setup 中不能访问到 Vue2.x 配置（data、methos、computed…）。</li>
<li>如果有重名, setup 优先。</li>
</ul>
</li>
<li><p>setup 不能是一个 async 函数，因为返回值不再是 return 的对象, 而是 promise, 模板看不到 return 对象中的属性。（后期也可以返回一个 Promise 实例，但需要 Suspense 和异步组件的配合）</p>
</li>
</ol>
<h2 id="另外注意：setup-不可以使用-this"><a href="#另外注意：setup-不可以使用-this" class="headerlink" title="另外注意：setup 不可以使用 this"></a>另外注意：setup 不可以使用 this</h2><p><strong>官方关于 this 有这样一段描述</strong></p>
<p>表达的含义是 this 并没有指向当前组件实例；</p>
<p>并且在 setup 被调用之前，data、computed、methods 等都没有被解析；</p>
<p>所以无法在 setup 中获取 this；</p>
<p><img src="/img/md/v3_4.png"></p>
<p><strong>其实在之前的这段描述是和源码有出入的：</strong></p>
<p>之前的描述大概含义是不可以使用 this 是因为组件实例还没有被创建出来；</p>
<p>通过阅读源码发现，代码是按照如下顺序执行的：</p>
<p>调用 createComponentInstance 创建组件实 例；</p>
<p>调用 setupComponent 初始化 component 内 部的操作；</p>
<p>调用 setupStatefulComponent 初始化有状态的组件；</p>
<p>在 setupStatefulComponent 取出了 setup 函 数；</p>
<p>通过 callWithErrorHandling 的函数执行 setup；</p>
<p>从上面的代码我们可以看出， <strong>组件的 instance 肯定是在执行 setup 函数之前就创建出来了。</strong></p>
<p><img src="/img/md/v3_5.png"></p>
<h1 id="响应式原理"><a href="#响应式原理" class="headerlink" title="响应式原理"></a>响应式原理</h1><h2 id="Vue2"><a href="#Vue2" class="headerlink" title="Vue2"></a>Vue2</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// vue2.x 双向数据绑定原理是通过Objcet.defineProperty来实现的</span></span><br><span class="line"><span class="comment">// 这种方式有缺点: 数组的长度 数组的内容发生变化检测不到</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;zs&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="attr">phone</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;iphone&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// let obj = [1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="comment">// 视图更新的方法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;视图更新了 ~&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> methods = [<span class="string">&quot;push&quot;</span>, <span class="string">&quot;pop&quot;</span>, <span class="string">&quot;shift&quot;</span>, <span class="string">&quot;unshift&quot;</span>, <span class="string">&quot;sort&quot;</span>, <span class="string">&quot;reverse&quot;</span>, <span class="string">&quot;splice&quot;</span>];</span><br><span class="line"><span class="comment">// 将数组的原型保存一份</span></span><br><span class="line"><span class="keyword">let</span> arrProto = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line"><span class="comment">// 创建原型 将数组原型拷贝一份</span></span><br><span class="line"><span class="keyword">let</span> proto = <span class="title class_">Object</span>.<span class="title function_">create</span>(arrProto);</span><br><span class="line"><span class="comment">// 重写数组的方法</span></span><br><span class="line">methods.<span class="title function_">forEach</span>(<span class="function">(<span class="params">method</span>) =&gt;</span> &#123;</span><br><span class="line">  proto[method] = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// AOP 面向切面编程</span></span><br><span class="line">    <span class="comment">// 改变了数组的数据</span></span><br><span class="line">    arrProto[method].<span class="title function_">call</span>(<span class="variable language_">this</span>, ...<span class="variable language_">arguments</span>);</span><br><span class="line">    <span class="comment">// 重新渲染视图</span></span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察者模式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">observe</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="comment">// 判断一个对象是不是数组</span></span><br><span class="line">  <span class="comment">// if(Object.prototype.toString.call(obj) === &#x27;[object Array]&#x27;)&#123;</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(obj)) &#123;</span><br><span class="line">    <span class="comment">// 让观测的对象的原型和我们自己重写的原型建立关系</span></span><br><span class="line">    obj.<span class="property">__proto__</span> = proto;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 如果观察的是一个对象的话 对其属性进行响应式监听(set、get)</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(obj) === <span class="string">&quot;[object Object]&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// 取出对象中的每一个键和值</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">      <span class="comment">// 调用响应式处理函数</span></span><br><span class="line">      <span class="title function_">defineReactive</span>(obj, key, obj[key]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 观察obj对象</span></span><br><span class="line"><span class="title function_">observe</span>(obj);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应式处理</span></span><br><span class="line"><span class="comment">// Object.defineProperty() 方法会直接在一个对象上定义一个新属性，或者修改一个对象的现有属性，并返回此对象。</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">defineReactive</span>(<span class="params">obj, key, val</span>) &#123;</span><br><span class="line">  <span class="comment">// 检测对象的属性值是否还是对象</span></span><br><span class="line">  <span class="title function_">observe</span>(val);</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">    <span class="comment">// 获取</span></span><br><span class="line">    <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> val;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 设置</span></span><br><span class="line">    <span class="title function_">set</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">      <span class="comment">// 检测设置的值是不是对象</span></span><br><span class="line">      <span class="title function_">observe</span>(newVal);</span><br><span class="line">      <span class="comment">// 新值和旧值不相等的时候</span></span><br><span class="line">      <span class="keyword">if</span> (newVal !== val) &#123;</span><br><span class="line">        <span class="comment">// 覆盖掉原来的val值</span></span><br><span class="line">        val = newVal;</span><br><span class="line">        <span class="comment">// 通知render函数重新渲染视图</span></span><br><span class="line">        <span class="title function_">render</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// obj.name = &#x27;lisi&#x27;</span></span><br><span class="line"><span class="comment">// obj.age = 20</span></span><br><span class="line"><span class="comment">// console.log(obj.name, obj.age);</span></span><br><span class="line"><span class="comment">// 至此 基本可以实现数据发生变化 视图更新的效果</span></span><br><span class="line"><span class="comment">// 但是 如果数据有多层呢 也就是属性对应的值也是对象?</span></span><br><span class="line"><span class="comment">// obj.phone.name = &#x27;huawei&#x27;</span></span><br><span class="line"><span class="comment">// console.log(obj.phone.name);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改的值和原来的值一样 不需要重新渲染视图</span></span><br><span class="line"><span class="comment">// obj.phone.name = &#x27;iphone&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果重新为对象obj的phone赋值一个新的对象呢? 视图要重新渲染</span></span><br><span class="line"><span class="comment">// obj.phone = &#123;name: &#x27;huawei&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 并且当修改新的对象的属性值时 视图也要重新渲染</span></span><br><span class="line"><span class="comment">// obj.phone.name = &#x27;zs&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 为对象新增属性值呢? 也是没有办法监测到的</span></span><br><span class="line"><span class="comment">// obj.sex = &#x27;man&#x27;</span></span><br><span class="line"><span class="comment">// $set来解决这个</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">$myset</span>(<span class="params">obj, key, val</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(obj)) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj.<span class="title function_">splice</span>(key, val);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">defineReactive</span>(obj, key, val);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// $myset(obj, &#x27;sex&#x27;, &#x27;man&#x27;)</span></span><br><span class="line"><span class="comment">// 修改新增的属性值 视图也能更新</span></span><br><span class="line"><span class="comment">// obj.sex = &#x27;woman&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// obj.phone = Object.assign(obj.phone, &#123;price: &#x27;666&#x27;&#125;)</span></span><br><span class="line"><span class="comment">// obj.phone.price = 888</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// obj.phone = &#123;...obj.phone, ...&#123;price: &#x27;666&#x27;&#125;&#125;</span></span><br><span class="line"><span class="comment">// obj.phone.price = &#x27;888&#x27;</span></span><br><span class="line"><span class="comment">// 以后vue涉及到给data中的对象新增属性时 有三种方式</span></span><br><span class="line"><span class="comment">// 1、this.$set() || Vue.set()</span></span><br><span class="line"><span class="comment">// 2、obj = Object.assign(原对象, 新对象(新增的属性:值))</span></span><br><span class="line"><span class="comment">// 2、obj = &#123;...原对象, ...新对象(新增的属性:值)&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// =================== 数组 ======================</span></span><br><span class="line"><span class="comment">// 数组的响应式数据处理依赖的并不是Object.defineProperty 而是对数组的能够引起数据变化的方法进行重写</span></span><br><span class="line"><span class="comment">// obj.push(6)</span></span><br><span class="line"><span class="comment">// obj.length ++</span></span><br><span class="line"><span class="comment">// obj[0] = 88</span></span><br><span class="line"><span class="comment">// $myset(obj, &#x27;0&#x27;, 66)</span></span><br></pre></td></tr></table></figure>

<h2 id="Vue3"><a href="#Vue3" class="headerlink" title="Vue3"></a>Vue3</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// vue3响应式原理利用了es6提供的proxy Api</span></span><br><span class="line"><span class="comment">// 可以直接监听到对象和数组内容及长度的变化</span></span><br><span class="line"><span class="comment">// 缺点: 兼容性差 支持就用proxy 不支持就用Objcet.defineProperty</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;zs&quot;</span>,</span><br><span class="line">  <span class="attr">girlFriend</span>: &#123; <span class="attr">name</span>: <span class="string">&quot;刘亦菲&quot;</span> &#125;,</span><br><span class="line">  <span class="attr">arr</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;视图重新渲染 ~&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> handler = &#123;</span><br><span class="line">  <span class="title function_">get</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">    <span class="comment">// Reflect.get(target, propertyKey[, receiver])</span></span><br><span class="line">    <span class="comment">// 获取对象身上某个属性的值，类似于 target[name]。</span></span><br><span class="line">    <span class="comment">// 如果属性的值是一个对象的话 则重新进行代理 设置set&amp;get</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> target[key] == <span class="string">&quot;object&quot;</span> &amp;&amp; target[key] != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(target[key], handler);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">set</span>(<span class="params">target, key, val</span>) &#123;</span><br><span class="line">    <span class="comment">// if(target[key] == &#x27;length&#x27;) return true</span></span><br><span class="line">    <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, val);</span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line">    <span class="comment">// return true表示赋值成功 如果不返回true 在严格模式下可能会报TypeError</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, handler);</span><br><span class="line"><span class="comment">// 使用代理后的对象</span></span><br><span class="line"><span class="comment">// console.log(proxy.name);</span></span><br><span class="line"><span class="comment">// console.log(proxy.grilFriend);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// proxy.name = &#x27;lisi&#x27;</span></span><br><span class="line"><span class="comment">// 修改深层次的对象的属性 无法监听到</span></span><br><span class="line"><span class="comment">// proxy.grilFriend.name = &#x27;黄圣依&#x27;</span></span><br><span class="line"><span class="comment">// console.log(proxy.name);</span></span><br><span class="line"><span class="comment">// console.log(proxy.grilFriend);</span></span><br><span class="line"><span class="comment">// console.log(obj.name);</span></span><br><span class="line"><span class="comment">// console.log(obj.grilFriend);</span></span><br><span class="line"></span><br><span class="line">proxy.<span class="property">arr</span>[<span class="number">0</span>] = <span class="string">&quot;11&quot;</span>;</span><br><span class="line">proxy.<span class="property">arr</span>.<span class="property">length</span>++;</span><br><span class="line"><span class="comment">// console.log(proxy.arr.length);</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">arr</span>.<span class="property">length</span>);</span><br></pre></td></tr></table></figure>

<h1 id="reactive-函数"><a href="#reactive-函数" class="headerlink" title="reactive 函数"></a>reactive 函数</h1><ul>
<li>作用: 定义一个<font color= "#FF0000"><strong>对象类型</strong></font>的响应式数据（基本类型不要用它，控制台会报警告，要用 ref 函数）</li>
<li>语法：const 代理对象&#x3D; reactive(源对象)<ul>
<li>接收一个对象（或数组），返回一个<font color= "#FF0000"><strong>代理对象（Proxy 的实例对象，简称 proxy 对象）</strong></font></li>
</ul>
</li>
<li>reactive 定义的响应式数据是“深层次的”。</li>
<li>内部基于 ES6 的 Proxy 实现，通过代理对象操作源对象内部数据进行操作。</li>
</ul>
<h2 id="为什么就可以变成响应式的呢？"><a href="#为什么就可以变成响应式的呢？" class="headerlink" title="为什么就可以变成响应式的呢？"></a>为什么就可以变成响应式的呢？</h2><p>这是因为当我们使用 reactive 函数处理我们的数据之后，数据再次被使用时就会进行依赖收集；</p>
<p>当数据发生改变时，所有收集到的依赖都是进行对应的响应式操作（比如更新界面）；</p>
<p>事实上，我们编写的 data 选项，也是在内部交给了 reactive 函数将其变成响应式对象的；</p>
<h2 id="reactive-判断的-API"><a href="#reactive-判断的-API" class="headerlink" title="reactive 判断的 API"></a>reactive 判断的 API</h2><h3 id="isProxy"><a href="#isProxy" class="headerlink" title="isProxy"></a>isProxy</h3><p>检查对象是否是由 reactive 或 readonly 创建的 proxy。</p>
<h3 id="isReactive"><a href="#isReactive" class="headerlink" title="isReactive"></a>isReactive</h3><p>检查对象是否是由 reactive 创建的响应式代理：</p>
<p>如果该代理是 readonly 建的，但包裹了由 reactive 创建的另一个代理，它也会返回 true；</p>
<h3 id="isReadonly"><a href="#isReadonly" class="headerlink" title="isReadonly"></a>isReadonly</h3><p>检查对象是否是由 readonly 创建的只读代理。</p>
<h3 id="toRaw"><a href="#toRaw" class="headerlink" title="toRaw"></a>toRaw</h3><p>返回 reactive 或 readonly 代理的原始对象（不建议保留对原始对象的持久引用。请谨慎使用）。</p>
<h3 id="shallowReactive"><a href="#shallowReactive" class="headerlink" title="shallowReactive"></a>shallowReactive</h3><p>创建一个响应式代理，它跟踪其自身 property 的响应性，但不执行嵌套对象的深层响应式转换 (深层还是原生对象)。</p>
<h3 id="shallowReadonly"><a href="#shallowReadonly" class="headerlink" title="shallowReadonly"></a>shallowReadonly</h3><p>创建一个 proxy，使其自身的 property 为只读，但不执行嵌套对象的深度只读转换（深层还是可读、可写的）。</p>
<p>只处理对象最外层属性的响应式（浅响应式）。</p>
<p>深度监听存在的问题： 如果数据量比较大，非常消耗性能。 有些时候我们并不需要对数据进行深度监听。 这个时候就没有必要使用 ref 和 reactive</p>
<h1 id="ref-函数"><a href="#ref-函数" class="headerlink" title="ref 函数"></a>ref 函数</h1><ul>
<li>作用: 定义一个响应式的数据</li>
<li>语法: const xxx &#x3D; ref(initValue)<ul>
<li>创建一个包含响应式数据的<font color= "#FF0000"> <strong>引用对象（reference 对象，简称 ref 对象）, 其内部的值是在 ref.value 属性中被维护的</strong></font></li>
<li>JS 中操作数据： xxx.value</li>
<li>模板中读取数据: vue 自动帮我们进行解包操作，不需要.value，直接：<div></div></li>
</ul>
</li>
<li>备注：<ul>
<li>接收的数据可以是：基本类型、也可以是对象类型。</li>
<li>基本类型的数据：响应式依然是靠 Object.defineProperty()的 get 与 set 完成的。</li>
<li>对象类型的数据：内部 求助 了 Vue3.0 中的一个新函数—— reactive 函数。</li>
</ul>
</li>
</ul>
<h2 id="toRefs"><a href="#toRefs" class="headerlink" title="toRefs"></a>toRefs</h2><p>如果我们使用 ES6 的解构语法，对 reactive 返回的对象进行解构获取值，那么之后无论是<strong>修改解构后的变量，还是修改 reactive 返回的 state 对象</strong>，数据都不再是响应式的：</p>
<p><img src="/img/md/v3_6.png"></p>
<p>那么有没有办法让我们<strong>解构出来的属性是响应式</strong>的呢？</p>
<p>Vue 为我们提供了一个 toRefs 的函数，可以将 reactive 返回的对象中的属性都转成 ref；</p>
<p>那么我们再次进行结构出来的 name 和 age 本身都是 ref 的；</p>
<p><img src="/img/md/v3_7.png"></p>
<p>这种做法相当于已经在 state.name 和 ref.value 之间建立了 链接，任何一个修改都会引起另外一个变化；</p>
<h2 id="toRef"><a href="#toRef" class="headerlink" title="toRef"></a>toRef</h2><p>如果我们只希望转换一个 reactive 对象中的属性为 ref, 那么可以使用 toRef 的方法</p>
<p><img src="/img/md/v3_8.png"></p>
<p>实际应用: 要将响应式对象中的某个属性单独提供给外部使用时。</p>
<h2 id="ref-的其它-API"><a href="#ref-的其它-API" class="headerlink" title="ref 的其它 API"></a>ref 的其它 API</h2><h3 id="unref"><a href="#unref" class="headerlink" title="unref"></a>unref</h3><p>如果我们想要<strong>获取一个 ref 引用中的 value</strong>，那么也可以通过<strong>unref</strong>方法：</p>
<p>如果参数是一个 ref，则返回内部值，否则返回参数本身；</p>
<p>这是 val &#x3D; isRef(val) ? val.value : val 的语法糖函数；</p>
<h3 id="isRef"><a href="#isRef" class="headerlink" title="isRef"></a>isRef</h3><p>判断值是否是一个 ref 对象。</p>
<h3 id="shallowRef"><a href="#shallowRef" class="headerlink" title="shallowRef"></a>shallowRef</h3><p>创建一个浅层的 ref 对象；</p>
<h3 id="triggerRef"><a href="#triggerRef" class="headerlink" title="triggerRef"></a>triggerRef</h3><p>手动触发和 shallowRef 相关联的副作用</p>
<p><img src="/img/md/v3_9.png"></p>
<h3 id="shallowReactive-与-shallowRef-的用法"><a href="#shallowReactive-与-shallowRef-的用法" class="headerlink" title="shallowReactive 与 shallowRef 的用法"></a>shallowReactive 与 shallowRef 的用法</h3><ul>
<li>shallowReactive：只处理对象最外层属性的响应式（浅响应式）。</li>
<li>shallowRef：只处理基本数据类型的响应式, 不进行对象的响应式处理。</li>
<li>使用场景：<ul>
<li>如果有一个对象数据，结构比较深, 但变化时只是外层属性变化 &#x3D;&#x3D;&#x3D;&gt; shallowReactive。</li>
<li>如果有一个对象数据，后续功能不会修改该对象中的属性，而是产生新的对象来替换 &#x3D;&#x3D;&#x3D;&gt; shallowRef。</li>
</ul>
</li>
</ul>
<h3 id="customRef"><a href="#customRef" class="headerlink" title="customRef"></a>customRef</h3><p>创建一个<strong>自定义的 ref</strong>，并<strong>对其依赖项跟踪和更新触发</strong>进行<strong>显示控制</strong>：</p>
<p>它需要一个工厂函数，该函数接受 track 和 trigger 函数作为参数；</p>
<p>并且应该返回一个带有 get 和 set 的对象；</p>
<p><strong>案例</strong>：</p>
<p>对双向绑定的属性进行 debounce(节流)的操作；</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;keyword&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123;keyword&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	<span class="keyword">import</span> &#123;ref,customRef&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	<span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="attr">name</span>:<span class="string">&#x27;Demo&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="title function_">setup</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="comment">// let keyword = ref(&#x27;hello&#x27;) //使用Vue准备好的内置ref</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="comment">//自定义一个myRef</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="keyword">function</span> <span class="title function_">myRef</span>(<span class="params">value,delay</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				<span class="keyword">let</span> timer</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				<span class="comment">//通过customRef去实现自定义</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				<span class="keyword">return</span> <span class="title function_">customRef</span>(<span class="function">(<span class="params">track,trigger</span>)=&gt;</span>&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">					<span class="keyword">return</span>&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">						<span class="title function_">get</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">							<span class="title function_">track</span>() <span class="comment">//告诉Vue这个value值是需要被“追踪”的</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">							<span class="keyword">return</span> value</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">						&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">						<span class="title function_">set</span>(<span class="params">newValue</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">							<span class="built_in">clearTimeout</span>(timer)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">							timer = <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">								value = newValue</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">								<span class="title function_">trigger</span>() <span class="comment">//告诉Vue去更新界面</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">							&#125;,delay)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">						&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">					&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="keyword">let</span> keyword = <span class="title function_">myRef</span>(<span class="string">&#x27;hello&#x27;</span>,<span class="number">500</span>) <span class="comment">//使用程序员自定义的ref</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				keyword</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h1 id="ref-amp-reactive"><a href="#ref-amp-reactive" class="headerlink" title="ref &amp; reactive"></a>ref &amp; reactive</h1><ul>
<li><p>从定义数据角度对比：</p>
<ul>
<li>ref 用来定义：<font color= "#FF0000"> <strong>基本类型数据</strong></font>。</li>
<li>reactive 用来定义：<font color= "#FF0000"> <strong>对象（或数组）类型数据</strong></font>。</li>
<li>备注：ref 也可以用来定义<font color= "#FF0000"> <strong>对象（或数组）类型数据</strong></font>, 它内部会自动通过 reactive 转为<font color= "#FF0000"> <strong>代理对象</strong></font>。</li>
</ul>
</li>
<li><p>从原理角度对比：</p>
<ul>
<li>ref 通过 Object.defineProperty()的 get 与 set 来实现响应式（数据劫持）。</li>
<li>reactive 通过使用<font color= "#FF0000"><strong>Proxy</strong></font>来实现响应式（数据劫持）, 并通过<font color= "#FF0000"><strong>Reflect</strong></font>操作<font color= "#ffa500"><strong>源对象</strong></font>内部的数据。</li>
</ul>
</li>
<li><p>从使用角度对比：</p>
<ul>
<li>ref 定义的数据：操作数据<font color= "#FF0000"><strong>需要</strong></font>.value，读取数据时模板中直接读取<font color= "#FF0000"><strong>不需要</strong></font>.value。</li>
<li>reactive 定义的数据：操作数据与读取数据：<font color= "#FF0000"><strong>均不需要</strong></font>.value。</li>
</ul>
</li>
</ul>
<h1 id="readonly"><a href="#readonly" class="headerlink" title="readonly"></a>readonly</h1><p>我们通过<strong>reactive 或者 ref 可以获取到一个响应式的对象</strong>，但是某些情况下，我们<strong>传入给其他地方（组件）的这个 响应式对象希望在另外一个地方（组件）被使用</strong>，但是<strong>不能被修改</strong>，这个时候<strong>如何防止这种情况</strong>的出现呢？</p>
<p>Vue3 为我们提供了 readonly 的方法；</p>
<p>readonly 会返回原生对象的只读代理（也就是它依然是一个 Proxy，这是一个 proxy 的 set 方法被劫持，并且不 能对其进行修改）；</p>
<h2 id="在开发中常见的-readonly-方法会传入三个类型的参数："><a href="#在开发中常见的-readonly-方法会传入三个类型的参数：" class="headerlink" title="在开发中常见的 readonly 方法会传入三个类型的参数："></a>在开发中常见的 readonly 方法会传入三个类型的参数：</h2><ol>
<li>类型一：普通对象；</li>
<li>类型二：reactive 返回的对象；</li>
<li>类型三：ref 的对象；</li>
</ol>
<h2 id="在-readonly-的使用过程中，有如下规则："><a href="#在-readonly-的使用过程中，有如下规则：" class="headerlink" title="在 readonly 的使用过程中，有如下规则："></a>在 readonly 的使用过程中，有如下规则：</h2><p>readonly 返回的对象都是不允许修改的；</p>
<p>但是经过 readonly 处理的原来的对象是允许被修改的；</p>
<p>比如 const info &#x3D; readonly(obj)，info 对象是不允许被修改的；</p>
<p>当 obj 被修改时，readonly 返回的 info 对象也会被修改；</p>
<p>但是我们不能去修改 readonly 返回的对象 info；</p>
<p>其实本质上就是 readonly 返回的对象的 setter 方法被劫持了而已；</p>
<p><strong>应用场景</strong>：在我们传递给其他组件数据时，往往希望其他组件使用我们传递的内容，但是不允许它们修改时，就可以使用 readonly 了；</p>
<h1 id="其它-Composition-API"><a href="#其它-Composition-API" class="headerlink" title="其它 Composition API"></a>其它 Composition API</h1><h2 id="toRaw-amp-markRaw"><a href="#toRaw-amp-markRaw" class="headerlink" title="toRaw &amp; markRaw"></a>toRaw &amp; markRaw</h2><ul>
<li>toRaw<ul>
<li>作用：将一个由 reactive 生成的<font color= "#ffa500"><strong>响应式对象</strong></font>转为<font color= "#ffa500"><strong>普通对象</strong></font>。</li>
<li>使用场景：用于读取响应式对象对应的普通对象，对这个普通对象的所有操作，不会引起页面更新。</li>
</ul>
</li>
<li>markRaw<ul>
<li>作用：标记一个对象，使其永远不会再成为响应式对象。</li>
<li>使用场景：<ul>
<li>有些值不应被设置为响应式的，例如复杂的第三方类库等。</li>
<li>当渲染具有不可变数据源的大列表时，跳过响应式转换可以提高性能。</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;hello&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; oldObj &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeInfo&quot;</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; toRaw, reactive, markRaw &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// let obj = reactive(&#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   name: &#x27;zs&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 获取 reactive 或 readonly 代理的原始对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// let oldObj = toRaw(obj)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// console.log(oldObj);</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// ======= markRaw ========</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> obj = &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 标记一个对象，使其永远不会再成为响应式对象。</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> oldObj = <span class="title function_">markRaw</span>(obj)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(oldObj);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 设置响应式失效</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    oldObj = <span class="title function_">reactive</span>(oldObj)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">changeInfo</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      oldObj.<span class="property">name</span> = <span class="string">&#x27;lisi&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 数据发生变化 =&gt; 视图没有更新</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(oldObj.<span class="property">name</span> );</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      oldObj,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      changeInfo</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="provide-与-inject"><a href="#provide-与-inject" class="headerlink" title="provide 与 inject"></a>provide 与 inject</h1><p><img src="/img/md/v3_10.png"></p>
<ul>
<li>作用：实现<font color= "#FF0000"><strong>祖与后代组件间</strong></font>通信</li>
<li>小套路：父组件有一个 provide 选项来提供数据，后代组件有一个 inject 选项来开始使用这些数据</li>
</ul>
<p>例：<br>祖组件中:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>)&#123;</span><br><span class="line">	......</span><br><span class="line">    <span class="keyword">let</span> car = <span class="title function_">reactive</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;奔驰&#x27;</span>,<span class="attr">price</span>:<span class="string">&#x27;40万&#x27;</span>&#125;)</span><br><span class="line">    <span class="title function_">provide</span>(<span class="string">&#x27;car&#x27;</span>,car)</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>后代组件中：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params">props,context</span>)&#123;</span><br><span class="line">	......</span><br><span class="line">    <span class="keyword">const</span> car = <span class="title function_">inject</span>(<span class="string">&#x27;car&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;car&#125;</span><br><span class="line">	......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="计算属性与监视"><a href="#计算属性与监视" class="headerlink" title="计算属性与监视"></a>计算属性与监视</h1><h2 id="computed"><a href="#computed" class="headerlink" title="computed"></a>computed</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    姓名: &#123;&#123; fullName &#125;&#125;&lt;br&gt;</span><br><span class="line">    修改姓名: &lt;input type=&quot;text&quot; v-model=&quot;fullName&quot;&gt;&lt;br&gt;</span><br><span class="line">    姓:&lt;input type=&quot;text&quot; v-model=&quot;stu.firstName&quot;&gt;&lt;br&gt;</span><br><span class="line">    名:&lt;input type=&quot;text&quot; v-model=&quot;stu.lastName&quot;&gt;&lt;br&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; reactive, computed &#125; from &#x27;vue&#x27;;</span><br><span class="line">export default &#123;</span><br><span class="line">  // vue2的computed简单写法</span><br><span class="line">  // computed: &#123;</span><br><span class="line">  //   fullName() &#123;</span><br><span class="line">  //     return this.stu.firstName + &#x27;-&#x27; + this.stu.lastName</span><br><span class="line">  //   &#125;</span><br><span class="line">  // &#125;,</span><br><span class="line">  // vue2的computed完整写法</span><br><span class="line">  // computed: &#123;</span><br><span class="line">  //   fullName: &#123;</span><br><span class="line">  //     get()&#123;</span><br><span class="line">  //       return this.stu.firstName + &#x27;-&#x27; + this.stu.lastName</span><br><span class="line">  //     &#125;,</span><br><span class="line">  //     set()&#123;</span><br><span class="line">  //       console.log(111);</span><br><span class="line">  //     &#125;</span><br><span class="line">  //   &#125;</span><br><span class="line">  // &#125;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    let stu = reactive(&#123;</span><br><span class="line">      firstName: &#x27;张&#x27;,</span><br><span class="line">      lastName: &#x27;三&#x27;</span><br><span class="line">    &#125;)</span><br><span class="line">    // vu3 computed 简写 =&gt; 修改报警告需要提供setter</span><br><span class="line">    // let fullName = computed(()=&gt;&#123;</span><br><span class="line">    //   return stu.firstName + &#x27;-&#x27; + stu.lastName</span><br><span class="line">    // &#125;)</span><br><span class="line">    // 挂载到stu上</span><br><span class="line">    // stu.fullName = computed(()=&gt;&#123;</span><br><span class="line">    //   return stu.firstName + &#x27;-&#x27; + stu.lastName</span><br><span class="line">    // &#125;)</span><br><span class="line"></span><br><span class="line">    // vue3 computed 完整写法 =&gt; 可读可写</span><br><span class="line">    let fullName = computed(&#123;</span><br><span class="line">      get() &#123;</span><br><span class="line">        return stu.firstName + &#x27;-&#x27; + stu.lastName</span><br><span class="line">      &#125;,</span><br><span class="line">      set(val)&#123;</span><br><span class="line">        let arr = val.split(&#x27;-&#x27;)</span><br><span class="line">        stu.firstName = arr[0]</span><br><span class="line">        stu.lastName = arr[1]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    return &#123;</span><br><span class="line">      stu,</span><br><span class="line">      fullName</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h2><ul>
<li>与 Vue2.x 中 watch 配置功能一致</li>
<li>两个小“坑”：<ul>
<li>监视 reactive 定义的响应式数据时：oldValue 无法正确获取、强制开启了深度监视（deep 配置失效）。</li>
<li>监视 reactive 定义的响应式数据中某个属性时：deep 配置有效。</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//情况一：监视ref定义的响应式数据</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  sum,</span><br><span class="line">  <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;sum变化了&quot;</span>, newValue, oldValue);</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">immediate</span>: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//情况二：监视多个ref定义的响应式数据</span></span><br><span class="line"><span class="title function_">watch</span>([sum, msg], <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;sum或msg变化了&quot;</span>, newValue, oldValue);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 情况三：监视reactive定义的响应式数据</span></span><br><span class="line"><span class="comment">   若watch监视的是reactive定义的响应式数据，则无法正确获得oldValue！！</span></span><br><span class="line"><span class="comment">   若watch监视的是reactive定义的响应式数据，则强制开启了深度监视 </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  person,</span><br><span class="line">  <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;person变化了&quot;</span>, newValue, oldValue);</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">immediate</span>: <span class="literal">true</span>, <span class="attr">deep</span>: <span class="literal">false</span> &#125;</span><br><span class="line">); <span class="comment">//此处的deep配置不再奏效</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//情况四：监视reactive定义的响应式数据中的某个属性</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> person.<span class="property">job</span>,</span><br><span class="line">  <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;person的job变化了&quot;</span>, newValue, oldValue);</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">immediate</span>: <span class="literal">true</span>, <span class="attr">deep</span>: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//情况五：监视reactive定义的响应式数据中的某些属性</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  [<span class="function">() =&gt;</span> person.<span class="property">job</span>, <span class="function">() =&gt;</span> person.<span class="property">name</span>],</span><br><span class="line">  <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;person的job变化了&quot;</span>, newValue, oldValue);</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">immediate</span>: <span class="literal">true</span>, <span class="attr">deep</span>: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//特殊情况</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> person.<span class="property">job</span>,</span><br><span class="line">  <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;person的job变化了&quot;</span>, newValue, oldValue);</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">deep</span>: <span class="literal">true</span> &#125;</span><br><span class="line">); <span class="comment">//此处由于监视的是reactive定义的对象中的某个属性，所以deep配置有效</span></span><br></pre></td></tr></table></figure>

<p>在前面的 Options API 中，我们可以通过 watch 选项来侦听 data 或者 props 的数据变化，当数据变化时执行某一些 操作。</p>
<p>而在 Composition API 中，我们可以使用 watchEffect 和 watch 来完成响应式数据的侦听；</p>
<p>watchEffect 用于自动收集响应式数据的依赖；</p>
<p>watch 需要手动指定侦听的数据源；</p>
<h2 id="watchEffect"><a href="#watchEffect" class="headerlink" title="watchEffect"></a>watchEffect</h2><ul>
<li>watch 的套路是：既要指明监视的属性，也要指明监视的回调。</li>
<li>watchEffect 的套路是：不用指明监视哪个属性，监视的回调中用到哪个属性，那就监视哪个属性。watchEffect 是默认会执行一次。</li>
<li>watchEffect 有点像 computed：<ul>
<li>但 computed 注重的计算出来的值（回调函数的返回值），所以必须要写返回值。</li>
<li>而 watchEffect 更注重的是过程（回调函数的函数体），所以不用写返回值。</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">watchEffect所指定的回调中用到的数据只要发生变化，则直接重新执行回调。</span><br><span class="line"><span class="title function_">watchEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> x1 = sum.<span class="property">value</span></span><br><span class="line">    <span class="keyword">const</span> x2 = person.<span class="property">age</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;watchEffect配置的回调执行了&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="watchEffect-停止侦听"><a href="#watchEffect-停止侦听" class="headerlink" title="watchEffect 停止侦听"></a>watchEffect 停止侦听</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ref定义的响应式数据</span></span><br><span class="line">    <span class="keyword">let</span> num = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">let</span> stu = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">      <span class="attr">friend</span>: &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;lisi&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> <span class="title function_">addNum</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      ++num.<span class="property">value</span></span><br><span class="line">      <span class="keyword">if</span> (num.<span class="property">value</span> &gt; <span class="number">5</span>) &#123;</span><br><span class="line">        <span class="comment">// 停止侦听</span></span><br><span class="line">        <span class="title function_">stop</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 首先，watchEffect传入的函数会被立即执行一次，并且在执行的过程中会收集依赖；</span></span><br><span class="line">    <span class="comment">// 其次，只有收集的依赖发生变化时，watchEffect传入的函数才会再次执行；</span></span><br><span class="line">    <span class="keyword">let</span> stop = <span class="title function_">watchEffect</span>(<span class="function">(<span class="params">onInvalidate</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 没有所谓的深度监视</span></span><br><span class="line">      <span class="comment">// console.log(num.value, stu.friend.name);</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(num.<span class="property">value</span>);</span><br><span class="line">      <span class="title function_">onInvalidate</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;取消上一次请求~&#x27;</span>);</span><br><span class="line">        <span class="built_in">clearTimeout</span>(timeId)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">const</span> timeId = <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;发起请求~&#x27;</span>);</span><br><span class="line">      &#125;, <span class="number">2000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      num,</span><br><span class="line">      addNum,</span><br><span class="line">      ...<span class="title function_">toRefs</span>(stu)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h2 id="watchEffect-清除副作用"><a href="#watchEffect-清除副作用" class="headerlink" title="watchEffect 清除副作用"></a>watchEffect 清除副作用</h2><p><font color= "#FF0000"><strong>什么是副作用呢？</strong></font></p>
<p>比如在开发中我们需要在侦听函数中执行网络请求，但是在网络请求还没有达到的时候，我们停止了侦听器， 或者侦听器侦听函数被再次执行了。</p>
<p>那么上一次的网络请求应该被取消掉，这个时候我们就可以清除上一次的副作用；</p>
<p>在我们给 watchEffect 传入的函数被回调时，其实可以获取到一个参数：onInvalidate</p>
<p>当<font color= "#ffa500"><strong>副作用即将重新执行</strong></font> 或者 <font color= "#ffa500"><strong>侦听器被停止</strong></font> 时会执行该函数传入的回调函数；</p>
<p>我们可以在传入的回调函数中，执行一些清除工作；</p>
<p><font color= "#FF0000"><strong>代码参上</strong></font></p>
<h2 id="setup-中使用-ref"><a href="#setup-中使用-ref" class="headerlink" title="setup 中使用 ref"></a>setup 中使用 ref</h2><p>在学习 watchEffect 执行时机之前，先补充一个知识：在 setup 中如何使用 ref 获取元素或者组件？</p>
<p>其实非常简单，我们只需要定义一个 ref 对象，绑定到元素或者组件的 ref 属性上即可；</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">ref</span>=<span class="string">&quot;title&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; ref, watchEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// vue2中的ref是用来获取dom元素或者组件实例的</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// console.log(this.$refs.title);</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// vue3中没有 this 获取不到</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> title = <span class="title function_">ref</span>(<span class="literal">null</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">watchEffect</span>(<span class="function">()=&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(title.<span class="property">value</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">flush</span>: <span class="string">&#x27;post&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      title</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="watchEffect-的执行时机"><a href="#watchEffect-的执行时机" class="headerlink" title="watchEffect 的执行时机"></a>watchEffect 的执行时机</h2><p>默认情况下，组件的更新会在副作用函数执行之前：</p>
<p>如果我们希望在副作用函数中获取到元素，是否可行呢？</p>
<p>如上代码我们会发现打印结果打印了两次：</p>
<p>这是因为 setup 函数在执行时就会立即执行传入的副作用函数，这个时候 DOM 并没有挂载，所以打印为 null；</p>
<p>而当 DOM 挂载时，会给 title 的 ref 对象赋值新的值，副作用函数会再次执行，打印出来对应的元素；</p>
<h2 id="调整-watchEffect-的执行时机"><a href="#调整-watchEffect-的执行时机" class="headerlink" title="调整 watchEffect 的执行时机"></a>调整 watchEffect 的执行时机</h2><p>如果我们希望在第一次的时候就打印出来对应的元素呢？</p>
<p>这个时候我们需要改变副作用函数的执行时机；</p>
<p>它的默认值是 pre，它会在元素 挂载 或者 更新 之前执行；</p>
<p>所以我们会先打印出来一个空的，当依赖的 title 发生改变时，就会再次执行一次，打印出元素；</p>
<p>flush 选项还接受 sync，这将强制效果始终同步触发。然而，这是低效的，应该很少需要。</p>
<h2 id="watch-函数总结"><a href="#watch-函数总结" class="headerlink" title="watch 函数总结"></a>watch 函数总结</h2><p>与 watchEffect 的比较，watch 允许我们：</p>
<p>懒执行副作用（第一次不会直接执行）；</p>
<p>更具体的说明当哪些状态发生变化时，触发侦听器的执行；</p>
<p>访问侦听状态变化前后的值；</p>
<h1 id="生命周期函数"><a href="#生命周期函数" class="headerlink" title="生命周期函数"></a>生命周期函数</h1><ul>
<li><p>Vue3.0 中可以继续使用 Vue2.x 中的生命周期钩子，但有有两个被更名：</p>
<ul>
<li><font color= "#ffa500"><strong>beforeDestroy</strong></font>改名为 <font color= "#ffa500"><strong>beforeUnmount</strong></font></li>
<li><font color= "#ffa500"><strong>destroyed</strong></font>改名为 <font color= "#ffa500"><strong>unmounted</strong></font></li>
</ul>
</li>
<li><p>Vue3.0 也提供了 Composition API 形式的生命周期钩子，与 Vue2.x 中钩子对应关系如下：</p>
<ul>
<li><font color= "#ffa500"><strong>beforeCreate</strong></font>&#x3D;&#x3D;&#x3D;&gt;<font color= "#ffa500"><strong>setup()</strong></font></li>
<li><font color= "#ffa500"><strong>created</strong></font>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;<font color= "#ffa500"><strong>setup()</strong></font></li>
<li><font color= "#ffa500"><strong>beforeMount</strong></font> &#x3D;&#x3D;&#x3D;&gt;<font color= "#ffa500"><strong>onBeforeMount</strong></font></li>
<li><font color= "#ffa500"><strong>mounted</strong></font>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;<font color= "#ffa500"><strong>onMounted</strong></font></li>
<li><font color= "#ffa500"><strong>beforeUpdate</strong></font>&#x3D;&#x3D;&#x3D;&gt;<font color= "#ffa500"><strong>onBeforeUpdate</strong></font></li>
<li><font color= "#ffa500"><strong>updated</strong></font>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;<font color= "#ffa500"><strong>onUpdated</strong></font></li>
<li><font color= "#ffa500"><strong>beforeUnmount</strong></font> &#x3D;&#x3D;&gt;<font color= "#ffa500"><strong>onBeforeUnmount</strong></font></li>
<li><font color= "#ffa500"><strong>unmounted</strong></font> &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;<font color= "#ffa500"><strong>onUnmounted</strong></font></li>
</ul>
</li>
</ul>
<p><img src="/img/md/v3_11.png"></p>
<h1 id="自定义-hook-函数"><a href="#自定义-hook-函数" class="headerlink" title="自定义 hook 函数"></a>自定义 hook 函数</h1><ul>
<li>什么是 hook？—— 本质是一个函数，把 setup 函数中使用的 Composition API 进行了封装。</li>
<li>类似于 vue2.x 中的 mixin。</li>
<li>自定义 hook 的优势: 复用代码, 让 setup 中的逻辑更清楚易懂。</li>
</ul>
<h2 id="useCounter"><a href="#useCounter" class="headerlink" title="useCounter"></a>useCounter</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, computed &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    count.<span class="property">value</span>++;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">decrement</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    count.<span class="property">value</span>--;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> doubleCount = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> count.<span class="property">value</span> * <span class="number">2</span>;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    count,</span><br><span class="line">    doubleCount,</span><br><span class="line">    increment,</span><br><span class="line">    decrement,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="useTitle"><a href="#useTitle" class="headerlink" title="useTitle"></a>useTitle</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, reactive, watch &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params">title = <span class="string">&quot;默认title&quot;</span></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> titleRef = <span class="title function_">ref</span>(title);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">watch</span>(titleRef, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">title</span> = titleRef.<span class="property">value</span>;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> titleRef;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="App-vue"><a href="#App-vue" class="headerlink" title="App.vue"></a>App.vue</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; doubleCount &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;increment&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;decrement&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> useCounter <span class="keyword">from</span> <span class="string">&#x27;./hooks/useCounter&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> useTitle <span class="keyword">from</span> <span class="string">&#x27;./hooks/useTitle&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; toRefs, reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> counter = <span class="title function_">reactive</span>(<span class="title function_">useCounter</span>())</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">useTitle</span>().<span class="property">value</span> = <span class="string">&#x27;使用hooks&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      ...<span class="title function_">toRefs</span>(counter)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h1 id="setup-的顶层编写方式"><a href="#setup-的顶层编写方式" class="headerlink" title="setup 的顶层编写方式"></a>setup 的顶层编写方式</h1><blockquote>
<p>博客：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43931876/article/details/120058286">https://blog.csdn.net/weixin_43931876/article/details/120058286</a><br>官网：<a target="_blank" rel="noopener" href="https://v3.cn.vuejs.org/api/sfc-spec.html#script-setup">https://v3.cn.vuejs.org/api/sfc-spec.html#script-setup</a></p>
</blockquote>
<h1 id="新增组件"><a href="#新增组件" class="headerlink" title="新增组件"></a>新增组件</h1><h2 id="Fragment"><a href="#Fragment" class="headerlink" title="Fragment"></a>Fragment</h2><ul>
<li>在 Vue2 中: 组件必须有一个根标签</li>
<li>在 Vue3 中: 组件可以没有根标签, 内部会将多个标签包含在一个 Fragment 虚拟元素中</li>
<li>好处: 减少标签层级, 减小内存占用</li>
</ul>
<h2 id="Teleport"><a href="#Teleport" class="headerlink" title="Teleport"></a>Teleport</h2><ul>
<li>什么是 Teleport？—— Teleport 是一种能够将我们的<font color= "#FF0000"><strong>组件 html 结构移动</strong></font>到指定位置的技术</li>
</ul>
<p>App.vue</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    App组件</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Father</span>&gt;</span><span class="tag">&lt;/<span class="name">Father</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">Father</span> <span class="keyword">from</span> <span class="string">&#x27;./components/Father.vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">Father</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.app</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">padding</span>: <span class="number">40px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">background-color</span>: hotpink;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Father.vue</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;father&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    Father组件</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Son</span>&gt;</span><span class="tag">&lt;/<span class="name">Son</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">Son</span> <span class="keyword">from</span> <span class="string">&#x27;./Son.vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">Son</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params">props</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.father</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">padding</span>: <span class="number">40px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">background-color</span>: skyblue;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>Son.vue</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;son&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    Son组件</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;isShow = true&quot;</span>&gt;</span>显示弹窗<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">teleport</span> <span class="attr">to</span>=<span class="string">&quot;body&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;isShow&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mask&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dialog&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">h3</span>&gt;</span>我是一个弹窗<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;isShow = false&quot;</span>&gt;</span>关闭弹窗<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">teleport</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> isShow = <span class="title function_">ref</span>(<span class="literal">false</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      isShow</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.son</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">padding</span>: <span class="number">40px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">background-color</span>: yellow;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-tag">body</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">position</span>: relative;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.dialog</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">width</span>: <span class="number">300px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">height</span>: <span class="number">300px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">position</span>: absolute;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">left</span>: <span class="number">50%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">top</span>: <span class="number">50%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">background-color</span>: azure;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">text-align</span>: center;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.mask</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">width</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">height</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, .<span class="number">5</span>);</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="Suspense"><a href="#Suspense" class="headerlink" title="Suspense"></a>Suspense</h2><ul>
<li>等待异步组件时渲染一些额外内容，让应用有更好的用户体验</li>
</ul>
<p>App.vue</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    App组件</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:default</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Father</span>&gt;</span><span class="tag">&lt;/<span class="name">Father</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:fallback</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>精彩内容正在加载中 ...<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 静态加载 同步</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// import Father from &#x27;./components/Father.vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 异步加载</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; defineAsyncComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title class_">Father</span> = <span class="title function_">defineAsyncComponent</span>(<span class="function">()=&gt;</span><span class="title function_">import</span>(<span class="string">&#x27;./components/Father.vue&#x27;</span>))</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">Father</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.app</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">padding</span>: <span class="number">40px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">background-color</span>: hotpink;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Father.vue</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;father&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    Father组件</span></span><br><span class="line"><span class="language-xml">    &#123;&#123; num &#125;&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">async</span> <span class="title function_">setup</span>(<span class="params">props</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> num = <span class="title function_">ref</span>(<span class="number">0</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// return new Promise((resolve, rejects)=&gt; &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   setTimeout(function()&#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//     resolve(&#123;num&#125;)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   &#125;, 3000)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> res = <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, rejects</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">resolve</span>(&#123; num &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;, <span class="number">3000</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> res</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.father</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">padding</span>: <span class="number">40px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">background-color</span>: skyblue;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h1 id="全局-API-的转移"><a href="#全局-API-的转移" class="headerlink" title="全局 API 的转移"></a>全局 API 的转移</h1><p>Vue 2.x 有许多全局 API 和配置。</p>
<ul>
<li>例如：注册全局组件、注册全局指令等。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//注册全局组件</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;MyButton&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">template</span>: <span class="string">&#x27;&lt;button @click=&quot;count++&quot;&gt;Clicked &#123;&#123; count &#125;&#125; times.&lt;/button&gt;&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//注册全局指令</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;focus&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">inserted</span>: <span class="function"><span class="params">el</span> =&gt;</span> el.<span class="title function_">focus</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Vue3.0 中对这些 API 做出了调整：</p>
<ul>
<li>将全局的 API，即：Vue.xxx 调整到应用实例（app）上</li>
</ul>
<table>
<thead>
<tr>
<th align="center">2.x 全局 API（Vue）</th>
<th align="center">3.x 实例 API (app)</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Vue.config.xxxx</td>
<td align="center">app.config.xxxx</td>
</tr>
<tr>
<td align="center">Vue.config.productionTip</td>
<td align="center"><font color='#FF0000'><strong>移除</strong></font></td>
</tr>
<tr>
<td align="center">Vue.component</td>
<td align="center">app.component</td>
</tr>
<tr>
<td align="center">Vue.directive</td>
<td align="center">app.directive</td>
</tr>
<tr>
<td align="center">Vue.mixin</td>
<td align="center">app.mixin</td>
</tr>
<tr>
<td align="center">Vue.use</td>
<td align="center">app.use</td>
</tr>
<tr>
<td align="center">Vue.prototype</td>
<td align="center">app.config.globalProperties</td>
</tr>
</tbody></table>
<h1 id="其它改变"><a href="#其它改变" class="headerlink" title="其它改变"></a>其它改变</h1><ul>
<li><p>data 选项应始终被声明为一个函数。</p>
</li>
<li><p>过度类名的更改：</p>
<ul>
<li>Vue2.x 写法</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">.<span class="property">v</span>-enter,</span><br><span class="line">.<span class="property">v</span>-leave-to &#123;</span><br><span class="line"><span class="attr">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">.<span class="property">v</span>-leave,</span><br><span class="line">.<span class="property">v</span>-enter-to &#123;</span><br><span class="line"><span class="attr">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>Vue3.x 写法</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">.<span class="property">v</span>-enter-<span class="keyword">from</span>,</span><br><span class="line">   .<span class="property">v</span>-leave-to &#123;</span><br><span class="line">   <span class="attr">opacity</span>: <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   .<span class="property">v</span>-leave-<span class="keyword">from</span>,</span><br><span class="line">   .<span class="property">v</span>-enter-to &#123;</span><br><span class="line">   <span class="attr">opacity</span>: <span class="number">1</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><font color='#FF0000'><strong>移除</strong></font>keyCode 作为 v-on 的修饰符，同时也不再支持 config.keyCodes</p>
</li>
<li><p><font color='#FF0000'><strong>移除</strong></font>v-on.native 修饰符</p>
<ul>
<li>父组件中绑定事件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;my-component</span><br><span class="line">  v-<span class="attr">on</span>:close=<span class="string">&quot;handleComponentEvent&quot;</span></span><br><span class="line">  v-<span class="attr">on</span>:click=<span class="string">&quot;handleNativeClickEvent&quot;</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>子组件中声明自定义事件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">   <span class="attr">emits</span>: [<span class="string">&#x27;close&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>移除过滤器（filter）</p>
<blockquote>
<p>过滤器虽然这看起来很方便，但它需要一个自定义语法，打破大括号内表达式是 “只是 JavaScript” 的假设，这不仅有学习成本，而且有实现成本！建议用方法调用或计算属性去替换过滤器。</p>
</blockquote>
</li>
</ul>
<h1 id="h-函数"><a href="#h-函数" class="headerlink" title="h 函数"></a>h 函数</h1><p>Vue 推荐在绝大数情况下<strong>使用模板</strong>来创建你的 HTML，然而一些特殊的场景，你真的需要<strong>Javascript 的完全编程的能力</strong>，这个时候你可以使用<strong>渲染函数</strong> ，它<strong>比模板更接近编译器</strong>；</p>
<p>前面我们学习过 VNode 和 VDOM 的改变：</p>
<p>Vue 在生成真实的 DOM 之前，会将我们的节点转换成 VNode，而 VNode 组合在一起形成一颗树结构，就是虚拟 DOM（VDOM）；</p>
<p>事实上，我们之前编写的 template 中的 HTML 最终也是使用<strong>渲染函数</strong>生成对应的 VNode；</p>
<p>那么，如果你想充分的利用 JavaScript 的编程能力，我们可以自己来编写 createVNode 函数，生成对应的 VNode；</p>
<p>那么如何来做呢？使用 <font color='#ff0000'><strong>h()函数</strong></font></p>
<p>h() 函数是一个用于创建 vnode 的一个函数；</p>
<p>其实更准确的命名是 createVNode() 函数，但是为了简便在 Vue 将之简化为 h() 函数；</p>
<h2 id="如何使用？"><a href="#如何使用？" class="headerlink" title="如何使用？"></a>如何使用？</h2><p><img src="/img/md/v3_12.png"></p>
<p><strong>注意事项：</strong></p>
<p>如果没有 props，那么通常可以将 children 作为第二个参数传入；</p>
<p>如果会产生歧义，可以将 null 作为第二个参数传入，将 children 作为第三个参数传入；</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line"><span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;h4&#x27;</span>, &#123;<span class="attr">class</span>: <span class="string">&#x27;title&#x27;</span>&#125;, <span class="string">&quot;hello h函数&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="实现计数器"><a href="#实现计数器" class="headerlink" title="实现计数器"></a>实现计数器</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; h, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// data()&#123;</span></span><br><span class="line">  <span class="comment">//   return &#123;</span></span><br><span class="line">  <span class="comment">//     count: 0</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="comment">// return &#123; count &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;counter&#x27;</span> &#125;, [</span><br><span class="line">        <span class="title function_">h</span>(<span class="string">&#x27;h4&#x27;</span>, <span class="literal">null</span>, <span class="string">`当前计数为:<span class="subst">$&#123;count.value&#125;</span>`</span>),</span><br><span class="line">        <span class="title function_">h</span>(<span class="string">&#x27;button&#x27;</span>, &#123;</span><br><span class="line">          <span class="attr">onClick</span>: <span class="function">() =&gt;</span> count.<span class="property">value</span>++</span><br><span class="line">        &#125;, <span class="string">&#x27;++&#x27;</span>),</span><br><span class="line">        <span class="title function_">h</span>(<span class="string">&#x27;button&#x27;</span>, &#123;</span><br><span class="line">          <span class="attr">onClick</span>: <span class="function">() =&gt;</span> count.<span class="property">value</span>--</span><br><span class="line">        &#125;, <span class="string">&#x27;--&#x27;</span>)</span><br><span class="line">      ])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// render()&#123;</span></span><br><span class="line">  <span class="comment">//   return h(&#x27;div&#x27;, &#123;class: &#x27;counter&#x27;&#125;, [</span></span><br><span class="line">  <span class="comment">//     h(&#x27;h4&#x27;, null, `当前计数为:$&#123;this.count&#125;`),</span></span><br><span class="line">  <span class="comment">//     h(&#x27;button&#x27;, &#123;</span></span><br><span class="line">  <span class="comment">//       onClick: () =&gt; this.count ++</span></span><br><span class="line">  <span class="comment">//     &#125;, &#x27;++&#x27;),</span></span><br><span class="line">  <span class="comment">//     h(&#x27;button&#x27;, &#123;</span></span><br><span class="line">  <span class="comment">//       onClick: () =&gt; this.count --</span></span><br><span class="line">  <span class="comment">//     &#125;, &#x27;--&#x27;)</span></span><br><span class="line">  <span class="comment">//   ])</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="渲染插槽"><a href="#渲染插槽" class="headerlink" title="渲染插槽"></a>渲染插槽</h2><blockquote>
<p>先了解插槽的用法，可参照<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43931876/article/details/120058286">setup 顶层编写方式内的博客网址</a></p>
</blockquote>
<p>App.vue</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Hi</span> <span class="keyword">from</span> <span class="string">&#x27;./05-Hi&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">h</span>(<span class="title class_">Hi</span>, <span class="literal">null</span>, &#123;</span><br><span class="line">        <span class="attr">default</span>: <span class="function"><span class="params">props</span> =&gt;</span> <span class="title function_">h</span>(<span class="string">&#x27;h4&#x27;</span>, <span class="literal">null</span>, <span class="string">`05-render函数渲染插槽<span class="subst">$&#123;props.title&#125;</span>`</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>Hi.vue</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;h4&#x27;</span>, &#123;<span class="attr">class</span>: <span class="string">&#x27;title&#x27;</span>&#125;, [</span><br><span class="line">        <span class="title function_">h</span>(<span class="string">&#x27;h2&#x27;</span>,<span class="literal">null</span>, <span class="string">&quot;hi ~~&quot;</span>),</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$slots</span>.<span class="property">default</span> ?</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$slots</span>.<span class="title function_">default</span>(&#123;<span class="attr">title</span>: <span class="string">&quot;--本手俗手妙手无从下手&quot;</span>&#125;) : <span class="title function_">h</span>(<span class="string">&#x27;span&#x27;</span>, <span class="literal">null</span>, <span class="string">&#x27;Hi组件默认插槽内容&#x27;</span>)</span><br><span class="line">      ])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h1 id="jsx"><a href="#jsx" class="headerlink" title="jsx"></a>jsx</h1><p>如果我们希望<strong>在项目中使用 jsx，那么我们需要添加对 jsx 的支持</strong>：</p>
<p>jsx 我们通常会通过 Babel 来进行转换（React 编写的 jsx 就是通过 babel 转换的）；</p>
<p>对于 Vue 来说，我们只需要在 Babel 中配置对应的插件即可；</p>
<p>安装<strong>Babel 支持 Vue 的 jsx 插件</strong>：</p>
<p>npm install @vue&#x2F;babel-plugin-jsx -D</p>
<p>在<strong>babel.config.js</strong>配置文件中配置插件（现在好像不需要配置了）</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [<span class="string">&quot;@vue/cli-plugin-babel/preset&quot;</span>],</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="string">&quot;@vue/babel-plugin-jsx&quot;</span>],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="实现计数器-1"><a href="#实现计数器-1" class="headerlink" title="实现计数器"></a>实现计数器</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>) =&gt; <span class="variable language_">this</span>.<span class="property">count</span>++</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">decrement</span> = (<span class="params"></span>) =&gt; <span class="variable language_">this</span>.<span class="property">count</span>--</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>当前计数: &#123;this.count&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;increment&#125;</span>&gt;</span>++<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;decrement&#125;</span>&gt;</span>--<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="组件使用"><a href="#组件使用" class="headerlink" title="组件使用"></a>组件使用</h2><p>Hi.vue</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params">h</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Hi组件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;this.$slots.default ? this.$slots.default() : <span class="tag">&lt;<span class="name">span</span>&gt;</span>哇咔咔<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>App.vue</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Hi</span> <span class="keyword">from</span> <span class="string">&#x27;./06-Hi.vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>) =&gt; <span class="variable language_">this</span>.<span class="property">count</span>++</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">decrement</span> = (<span class="params"></span>) =&gt; <span class="variable language_">this</span>.<span class="property">count</span>--</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>当前计数: &#123;this.count&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;increment&#125;</span>&gt;</span>++<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;decrement&#125;</span>&gt;</span>--<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Hi</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;&#123;default: props =&gt; <span class="tag">&lt;<span class="name">button</span>&gt;</span>我是按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span>&#125;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Hi</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>setup 写法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Hi</span> <span class="keyword">from</span> <span class="string">&#x27;./06-Hi.vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>) =&gt; count.<span class="property">value</span>++</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">decrement</span> = (<span class="params"></span>) =&gt; count.<span class="property">value</span>--</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">getVal</span> = (<span class="params">num</span>) =&gt; &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(num)</span><br><span class="line">      <span class="comment">// vue3需要使用高阶函数来获取到e</span></span><br><span class="line">      <span class="keyword">return</span> <span class="function">(<span class="params">e</span>)=&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">target</span>.<span class="property">checked</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">()=&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">checked</span> <span class="attr">onChange</span>=<span class="string">&#123;</span> <span class="attr">getVal</span>(<span class="attr">1</span>) &#125;/&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">h4</span>&gt;</span>当前计数: &#123;count.value&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;increment&#125;</span>&gt;</span>++<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;decrement&#125;</span>&gt;</span>--<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h1 id="自定义指令"><a href="#自定义指令" class="headerlink" title="自定义指令"></a>自定义指令</h1><p>在 Vue 的模板语法中我们学习过各种各样的指令：v-show、v-for、v-model 等等，除了使用这些指令之外，<strong>Vue 也允许我们来自定义自己的指令</strong></p>
<p>注意：在 Vue 中，代码的复用和抽象主要还是通过组件；</p>
<p>通常在某些情况下，你需要对 DOM 元素进行底层操作，这个时候就会用到自定义指令；</p>
<p><font color='#ac6fe9' size='4'><strong>自定义指令分为两种：</strong></font></p>
<ol>
<li>自定义局部指令：组件中通过 directives 选项，只能在当前组件中使用；</li>
<li>自定义全局指令：app 的 directive 方法，可以在任意组件中被使用；</li>
</ol>
<p><font color='#ac6fe9' size='3'><strong>案例：当某个元素挂载完成后可以自定获取焦点</strong></font></p>
<ul>
<li>实现方式一：如果我们使用默认的实现方式；</li>
<li>实现方式二：自定义一个 v-focus 的局部指令；</li>
<li>实现方式三：自定义一个 v-focus 的全局指令；</li>
</ul>
<h2 id="聚焦实现"><a href="#聚焦实现" class="headerlink" title="聚焦实现"></a>聚焦实现</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;iptRef&quot;</span> <span class="attr">v-focus</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; ref, nextTick, onMounted, directives &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// directives选项</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// directives: &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//   focus: &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//     // 指令的生命周期 不是 vue3的生命周期</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//     mounted(el) &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//       el.focus()</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//     &#125;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//   &#125;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// &#125;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> iptRef = <span class="title function_">ref</span>(<span class="literal">null</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// nextTick(()=&gt;&#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   iptRef.value.focus()</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// onMounted(()=&gt; &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   iptRef.value.focus()</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      iptRef</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="局部自定义指令"><a href="#局部自定义指令" class="headerlink" title="局部自定义指令"></a>局部自定义指令</h2><p>自定义一个 v-focus 的局部指令</p>
<p>这个自定义指令实现非常简单，我们只需要在组件选项中使用 directives 即可；</p>
<p>它是一个对象，在对象中编写我们自定义指令的名称（注意：这里不需要加 v-）；</p>
<p>自定义指令有一个生命周期，是在组件挂载后调用的 mounted，我们可以在其中完成操作；</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;iptRef&quot;</span> <span class="attr">v-focus</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; ref, directives &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// directives选项</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">directives</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">focus</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 指令的生命周期 不是 vue3的生命周期</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">mounted</span>(<span class="params">el</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        el.<span class="title function_">focus</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="全局自定义指令"><a href="#全局自定义指令" class="headerlink" title="全局自定义指令"></a>全局自定义指令</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 全局自定义指令 =&gt; 放在mount之前</span></span><br><span class="line">app.<span class="title function_">directive</span>(<span class="string">&quot;focus&quot;</span>, &#123;</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    el.<span class="title function_">focus</span>();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="指令的生命周期"><a href="#指令的生命周期" class="headerlink" title="指令的生命周期"></a>指令的生命周期</h2><p><font color='#ac6fe9' size='3'><strong>一个指令定义的对象，Vue 提供了如下的几个钩子函数：</strong></font></p>
<ul>
<li>created：在绑定元素的 attribute 或事件监听器被应用之前调用；</li>
<li>beforeMount：当指令第一次绑定到元素并且在挂载父组件之前调用；</li>
<li>mounted：在绑定元素的父组件被挂载后调用；</li>
<li>beforeUpdate：在更新包含组件的 VNode 之前调用；</li>
<li>updated：在包含组件的 VNode 及其子组件的 VNode 更新后调用；</li>
<li>beforeUnmount：在卸载绑定元素的父组件之前调用；</li>
<li>unmounted：当指令与元素解除绑定且父组件已卸载时，只调用一次；</li>
</ul>
<h2 id="指令的参数和修饰符"><a href="#指令的参数和修饰符" class="headerlink" title="指令的参数和修饰符"></a>指令的参数和修饰符</h2><p>如果我们需要接受一些参数或者修饰符应该如何操作呢？</p>
<p>info 是参数的名称；</p>
<p>aaa-bbb 是修饰符的名称；</p>
<p>后面是传入的具体的值；</p>
<p>在我们的生命周期中，我们可以<strong>通过 bindings 获取</strong>到对应的内容：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-myDir.aaa.bbb</span>=<span class="string">&quot;&#123;name:&#x27;zs&#x27;&#125;&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;count &lt; 5&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123;count&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;increment&quot;</span>&gt;</span>++<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; ref, directives &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">directives</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">myDir</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;created&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">beforeMount</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;beforeMount&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">mounted</span>(<span class="params">el, binding</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(binding)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">beforeUpdate</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;beforeUpdate&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">updated</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;updated&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">beforeUnmount</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;beforeUnmount&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">unmounted</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;unmounted&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>)=&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      count.<span class="property">value</span> ++</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      count,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      increment</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h1 id="自定义指令练习"><a href="#自定义指令练习" class="headerlink" title="自定义指令练习"></a>自定义指令练习</h1><h2 id="自定义指令案例：时间戳的显示需求"><a href="#自定义指令案例：时间戳的显示需求" class="headerlink" title="自定义指令案例：时间戳的显示需求"></a>自定义指令案例：时间戳的显示需求</h2><p>在开发中，大多数情况下从服务器获取到的都是时间戳；</p>
<p>我们需要将时间戳转换成具体格式化的时间来展示；</p>
<p>在 Vue2 中我们可以通过过滤器来完成；</p>
<p>在 Vue3 中我们可以通过 计算属性（computed） 或者 自定义一个方法（methods） 来完成；</p>
<p>其实我们还可以通过一个自定义的指令来完成；</p>
<p>我们来实现一个可以<font color='#ac6fe9'><strong>自动对时间格式化的指令 v-format-time</strong></font>：</p>
<p>这里我封装了一个函数，在首页中我们只需要调用这个函数并且传入 app 即可；</p>
<p>format-time.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">&quot;dayjs&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (app) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 挂载全局自定义指令</span></span><br><span class="line">  app.<span class="title function_">directive</span>(<span class="string">&quot;format-time&quot;</span>, &#123;</span><br><span class="line">    <span class="title function_">mounted</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">      <span class="comment">// 获取到用户指定的格式</span></span><br><span class="line">      <span class="keyword">let</span> formatStr = binding.<span class="property">value</span>;</span><br><span class="line">      <span class="comment">// 如果用户没有传格式</span></span><br><span class="line">      <span class="keyword">if</span> (!binding.<span class="property">value</span>) &#123;</span><br><span class="line">        <span class="comment">// 给个默认的格式</span></span><br><span class="line">        formatStr = <span class="string">&quot;YYYY-MM-DD hh:mm:ss&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 拿到组件标签上的时间戳</span></span><br><span class="line">      <span class="keyword">let</span> timeStamp = el.<span class="property">textContent</span>;</span><br><span class="line">      <span class="keyword">if</span> (timeStamp.<span class="property">length</span> == <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="comment">// 秒 =&gt; 毫秒</span></span><br><span class="line">        timeStamp = timeStamp * <span class="number">1000</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      el.<span class="property">textContent</span> = <span class="title function_">dayjs</span>(<span class="built_in">parseInt</span>(timeStamp)).<span class="title function_">format</span>(formatStr);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js 引入自定义指令</span></span><br><span class="line"><span class="keyword">import</span> &#123; formatTime &#125; <span class="keyword">from</span> <span class="string">&quot;./directives&quot;</span>;</span><br><span class="line"><span class="title function_">formatTime</span>(app);</span><br></pre></td></tr></table></figure>

<p>Time.vue</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">v-format-time</span>=<span class="string">&quot;&#x27;YYYY/MM/DD&#x27;&quot;</span> &gt;</span> 1654766827786 <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>)=&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      count.<span class="property">value</span> ++</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      count,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      increment</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h1 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h1><p>通常我们向 Vue 全局添加一些功能时，会采用<font color='#edd345'><strong>插件的模式</strong></font>，它有两种编写方式：</p>
<ul>
<li>对象类型：一个对象，但是必须包含一个 install 的函数，该函数会在安装插件时执行；</li>
<li>函数类型：一个 function，这个函数会在安装插件时自动执行；</li>
</ul>
<p>插件可以<font color='#FF0000'><strong>完成的功能没有限制</strong></font>，比如下面的几种都是可以的：</p>
<ol>
<li>添加全局方法或者 property，通过把它们添加到 config.globalProperties 上实现；</li>
<li>添加全局资源：指令&#x2F;过滤器&#x2F;过渡等；</li>
<li>通过全局 mixin 来添加一些组件选项；</li>
</ol>
<p>一个库，提供自己的 API，同时提供上面提到的一个或多个功能；</p>
<p>App.vue</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>哥们 你这睡眠质量不行呀 我一般都8小时后才发现<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; getCurrentInstance &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// mounted()&#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//   console.log(this.$msg)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// &#125;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// console.log(this.$msg)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// setup中没有this指向 所以不能像vue2获取原型上的数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 需要按照下面的方式</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> instance = <span class="title function_">getCurrentInstance</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(instance.<span class="property">appContext</span>.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$msg</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js引入插件</span></span><br><span class="line"><span class="keyword">import</span> msgPluginObject <span class="keyword">from</span> <span class="string">&#x27;./plugins/msgPlugin-object&#x27;</span></span><br><span class="line"><span class="keyword">import</span> msgPluginFunction <span class="keyword">from</span> <span class="string">&#x27;./plugins/msgPlugin-function&#x27;</span></span><br><span class="line"><span class="comment">// 使用插件</span></span><br><span class="line"><span class="comment">// app.use(msgPluginObject)</span></span><br><span class="line"><span class="comment">// use相当于 msgPlugin.install(app)</span></span><br><span class="line">app.<span class="title function_">use</span>(msgPluginFunction)</span><br></pre></td></tr></table></figure>

<h2 id="函数写法"><a href="#函数写法" class="headerlink" title="函数写法"></a>函数写法</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (app) =&gt; &#123;</span><br><span class="line">  app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$msg</span> =</span><br><span class="line">    <span class="string">&quot;听说高考数学卷很难 刚刚试了下 两小时后才发现试卷拿反了&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="对象写法"><a href="#对象写法" class="headerlink" title="对象写法"></a>对象写法</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">app</span>) &#123;</span><br><span class="line">    <span class="comment">// 往app原型上添加属性</span></span><br><span class="line">    app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$msg</span> =</span><br><span class="line">      <span class="string">&quot;听说高考数学卷很难 刚刚试了下 两小时后才发现试卷拿反了&quot;</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h1><p>待更新~</p>
<h1 id="Vuex"><a href="#Vuex" class="headerlink" title="Vuex"></a>Vuex</h1><p>待更新~</p>
<h1 id="Pinia"><a href="#Pinia" class="headerlink" title="Pinia"></a>Pinia</h1><p>Vuex 作为一个老牌 Vue 状态管理库，大家都很熟悉了</p>
<p>Pinia 是 Vue.js 团队成员专门为 Vue 开发的一个全新的状态管理库，并且已经被纳入官方 <a target="_blank" rel="noopener" href="https://github.com/vuejs/pinia">github</a></p>
<h2 id="为什么有-Vuex-了还要再开发一个-Pinia-？"><a href="#为什么有-Vuex-了还要再开发一个-Pinia-？" class="headerlink" title="为什么有 Vuex 了还要再开发一个 Pinia ？"></a>为什么有 Vuex 了还要再开发一个 Pinia ？</h2><p>先来一张图，看下当时对于<strong>Vuex5 的提案</strong>，就是下一代 Vuex5 应该是什么样子的</p>
<p><img src="/img/md/v3_13.png"></p>
<p>Pinia 就是完整的符合了他当时 Vuex5 提案所提到的功能点，所以可以说 Pinia 就是 Vuex5 也不为过，因为它的作者就是官方的开发人员，并且已经被官方接管了，只是目前 Vuex 和 Pinia 还是两个独立的仓库，以后可能会合并，也可能独立发展，只是官方肯定推荐的是 Pinia</p>
<p>因为在 Vue3 中使用 Vuex 的话需要使用 Vuex4，并且还只能作为一个过渡的选择，存在很大缺陷，所以在 Componsition API 诞生之后，也就设计了全新的状态管理 Pinia</p>
<h2 id="Pinia-特性"><a href="#Pinia-特性" class="headerlink" title="Pinia 特性"></a>Pinia 特性</h2><ul>
<li>Pinia 没有 <font color= "#FF0000"><strong>Mutations</strong></font></li>
<li><font color= "#FF0000"><strong>Actions</strong></font> 支持同步和异步</li>
<li>没有模块的嵌套结构<ul>
<li>Pinia 通过设计提供扁平结构，就是说每个 store 都是互相独立的，谁也不属于谁，也就是扁平化了，更好的代码分割且没有命名空间。当然你也可以通过在一个模块中导入另一个模块来隐式嵌套 store，甚至可以拥有 store 的循环依赖关系</li>
</ul>
</li>
<li>更好的 <font color= "#FF0000"><strong>TypeScript</strong></font> 支持<ul>
<li>不需要再创建自定义的复杂包装器来支持 TypeScript 所有内容都类型化，并且 API 的设计方式也尽可能的使用 TS 类型推断</li>
</ul>
</li>
<li>不需要注入、导入函数、调用它们，享受自动补全，让我们开发更加方便</li>
<li>无需手动添加 store，它的模块默认情况下创建就自动注册的</li>
<li>Vue2 和 Vue3 都支持<ul>
<li>除了初始化安装和 SSR 配置之外，两者使用上的 API 都是相同的</li>
</ul>
</li>
<li>支持 <font color= "#FF0000"><strong>Vue DevTools</strong></font><ul>
<li>跟踪 actions, mutations 的时间线</li>
<li>在使用了模块的组件中就可以观察到模块本身</li>
<li>支持 time-travel 更容易调试</li>
<li>在 Vue2 中 Pinia 会使用 Vuex 的所有接口，所以它俩不能一起使用</li>
<li>但是针对 Vue3 的调试工具支持还不够完美，比如还没有 time-travel 功能</li>
</ul>
</li>
<li>模块热更新<ul>
<li>无需重新加载页面就可以修改模块</li>
<li>热更新的时候会保持任何现有状态</li>
</ul>
</li>
<li>支持使用插件扩展 Pinia 功能</li>
<li>支持服务端渲染</li>
</ul>
<h2 id="Pinia-和-Vuex"><a href="#Pinia-和-Vuex" class="headerlink" title="Pinia 和 Vuex"></a>Pinia 和 Vuex</h2><p><font color='#FF0000'>Pinia 特性也算</font></p>
<h3 id="核心区别"><a href="#核心区别" class="headerlink" title="核心区别"></a>核心区别</h3><p>Vuex： <font color= "#ffa500"><strong>State</strong></font> 、<font color= "#ffa500"><strong>Gettes</strong></font> 、<font color= "#ffa500"><strong>Mutations</strong></font>(同步) 、<font color= "#ffa500"><strong>Actions</strong></font>(异步)</p>
<p>Pinia： <font color= "#ffa500"><strong>State</strong></font> 、<font color= "#ffa500"><strong>Gettes</strong></font> 、<font color= "#ffa500"><strong>Actions</strong></font>(同步异步都支持)</p>
<h3 id="版本支持"><a href="#版本支持" class="headerlink" title="版本支持"></a>版本支持</h3><p>Vuex 当前最新版是 <font color= "#FF0000"><strong>4.x</strong></font></p>
<ul>
<li>Vuex4 用于 Vue3</li>
<li>Vuex3 用于 Vue2</li>
</ul>
<p>Pinia 当前最新版是 <font color= "#FF0000"><strong>2.x</strong></font></p>
<ul>
<li>即支持 Vue2 也支持 Vue3</li>
</ul>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><p>个人感觉：由于 Pinea 是轻量级的，体积很小，它适合于中小型应用。它也适用于低复杂度的 Vue.js 项目，因为一些调试功能，如时间旅行和编辑仍然不被支持。<br>将 Vuex 用于中小型 Vue.js 项目是过度的，因为它重量级的，对性能降低有很大影响。因此，Vuex 适用于大规模、高复杂度的 Vue.js 项目</p>
<h2 id="pinia-使用"><a href="#pinia-使用" class="headerlink" title="pinia 使用"></a>pinia 使用</h2><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><p>想要学习<font color= "#FF0000"><strong>pinia</strong></font>，最好有<font color= "#FF0000"><strong>Vue3</strong></font>的基础，明白<font color= "#FF0000"><strong>组合式 API</strong></font>是什么。如果你还不会 Vue3，建议先去学习 Vue3。</p>
<p>本篇全部基于<font color= "#FF0000"><strong>Vue3</strong></font>来讲解 pinia，至于 Vue2 中如何使用 pinia，大家可以自行去 pinia 官网学习，毕竟 Vue2 中使用 pinia 的还是少数。</p>
<h3 id="项目搭建"><a href="#项目搭建" class="headerlink" title="项目搭建"></a>项目搭建</h3><p>我们这里搭建一个最新的<font color= "#FF0000"><strong>Vue3 + TS + Vite</strong></font>项目。</p>
<p>执行命令：<font color= "#FF0000"><strong>vue create vue-pinia</strong></font> 选择 babel、vue3、ts，创建完毕，清空项目，启动项目 ~</p>
<h3 id="安装-pinia"><a href="#安装-pinia" class="headerlink" title="安装 pinia"></a>安装 pinia</h3><p>执行命令：<font color= "#FF0000"><strong>npm install pinia</strong></font></p>
<h3 id="使用-pinia"><a href="#使用-pinia" class="headerlink" title="使用 pinia"></a>使用 pinia</h3><p>安装完成后我们需要将<font color= "#FF0000"><strong>pinia 挂载到 Vue 应用中</strong></font>，也就是我们需要创建一个根存储传递给应用程序，简单来说就是创建一个存储数据的数据桶，放到应用程序中去。</p>
<p>修改<font color= "#FF0000"><strong>main.js</strong></font>，引入<font color= "#FF0000"><strong>pinia 提供的 createPinia 方法</strong></font>，创建根存储。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&quot;./App.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line">app.<span class="title function_">use</span>(pinia);</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&quot;#app&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>在 store 目录下创建一个 user.ts 为例，我们先定义并导出一个名为 user 的模块</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> userStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">count</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">arr</span>: []</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getters</span>: &#123; ... &#125;,</span><br><span class="line">    <span class="attr">actions</span>: &#123; ... &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><font color= "#ffa500"><strong>defineStore</strong></font> 接收两个参数</p>
<ul>
<li>第一个参数就是模块的名称，必须是唯一的，多个模块不能重名，Pinia 会把所有的模块都挂载到根容器上</li>
<li>第二个参数是一个对象，里面的选项和 Vuex 差不多<ul>
<li>其中 <font color= "#ffa500"><strong>state</strong></font> 用来存储全局状态，它必须是箭头函数，为了在服务端渲染的时候避免交叉请求导致的数据状态污染所以只能是函数，而必须用箭头函数则为了更好的 TS 类型推导</li>
<li><font color= "#ffa500"><strong>getters</strong></font> 就是用来封装计算属性，它有缓存的功能</li>
<li><font color= "#ffa500"><strong>actions</strong></font> 就是用来封装业务逻辑，修改 state</li>
</ul>
</li>
</ul>
<h3 id="访问-state"><a href="#访问-state" class="headerlink" title="访问 state"></a>访问 state</h3><p>比如我们要在页面中访问 state 里的属性 count</p>
<p>由于 <font color= "#ffa500"><strong>defineStore</strong></font> 会返回一个函数，所以要先调用拿到数据对象，然后就可以在模板中直接使用了</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; user_store.count &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; userStore &#125; <span class="keyword">from</span> <span class="string">&#x27;../store&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> user_store = <span class="title function_">userStore</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 解构</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// const &#123; count &#125; = userStore()</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>比如像注释中的解构出来使用，是完全没有问题的，只是注意了，这样拿到的数据不是<font color= "#ffa500"><strong>响应式</strong></font>的，如果要解构还保持响应式就要用到一个方法 <font color= "#ffa500"><strong>storeToRefs()</strong></font>，示例如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; storeToRefs &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; userStore &#125; <span class="keyword">from</span> <span class="string">&#x27;../store&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> &#123; count &#125; = <span class="title function_">storeToRefs</span>(userStore)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>原因就是 Pinia 其实是把 state 数据都做了 <font color= "#ffa500"><strong>reactive</strong></font> 处理，和 Vue3 的 reactive 同理，解构出来的也不是响应式，所以需要再做 <font color= "#ffa500"><strong>ref 响应式代理</strong></font></p>
<h3 id="getters"><a href="#getters" class="headerlink" title="getters"></a>getters</h3><p>这个和 Vuex 的 getters 一样，也有缓存功能。如下在页面中多次使用，第一次会调用 getters，数据没有改变的情况下之后会读取缓存</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; myCount &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; myCount &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; myCount &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>注意两种方法的区别，我就直接写在注释里了</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="comment">// 方法一，接收一个可选参数 state</span></span><br><span class="line">    <span class="title function_">myCount</span>(<span class="params">state</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;调用了&#x27;</span>) <span class="comment">// 页面中使用了三次，这里只会执行一次，然后缓存起来了</span></span><br><span class="line">        <span class="keyword">return</span> state.<span class="property">count</span> + <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 方法二，不传参数，使用 this</span></span><br><span class="line">    <span class="comment">// 但是必须指定函数返回值的类型，否则类型推导不出来</span></span><br><span class="line">    <span class="title function_">myCount</span>(): number&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">count</span> + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="actions"><a href="#actions" class="headerlink" title="actions"></a>actions</h3><p>更新 state 里的数据有四种方法，先看三种简单的更新，说明都写在注释里了</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; user_store.count &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;handleClick&quot;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; userStore &#125; <span class="keyword">from</span> <span class="string">&#x27;../store&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> user_store = <span class="title function_">userStore</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 方法一</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    user_store.<span class="property">count</span>++</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 方法二，需要修改多个数据，建议用 $patch 批量更新，传入一个对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    user_store.$patch(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">count</span>: user_store.<span class="property">count1</span>++,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// arr: user_store.arr.push(1) // 错误</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">arr</span>: [ ...user_store.<span class="property">arr</span>, <span class="number">1</span> ] <span class="comment">// 可以，但是还得把整个数组都拿出来解构，就没必要</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 使用 $patch 性能更优，因为多个数据更新只会更新一次视图</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 方法三，还是$patch，传入函数，第一个参数就是 state</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    user_store.$patch( <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        state.<span class="property">count</span>++</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        state.<span class="property">arr</span>.<span class="title function_">push</span>(<span class="number">1</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>第四种方法就是当逻辑比较多或者请求的时候，我们就可以封装到示例中 store&#x2F;user.ts 里的 actions 里</p>
<p>可以传参数，也可以通过 this.xx 可以直接获取到 state 里的数据，需要注意的是不能用箭头函数定义 actions，不然就会绑定外部的 this 了</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">changeState</span>(<span class="params">num: number</span>)&#123; <span class="comment">// 不能用箭头函数</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">count</span> += num</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  user_store.<span class="title function_">changeState</span>(<span class="number">1</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="支持-VueDevtools"><a href="#支持-VueDevtools" class="headerlink" title="支持 VueDevtools"></a>支持 VueDevtools</h3><p>打开开发者工具的 <font color='#ff0000'>Vue Devtools</font> 就会发现 Pinia，而且可以手动修改数据调试，非常方便</p>
<p>示例</p>
<ol>
<li><p>先定义示例接口 api&#x2F;user.ts</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 接口数据类型</span></span><br><span class="line"><span class="keyword">export</span> interface userListType&#123;</span><br><span class="line">   <span class="attr">id</span>: number</span><br><span class="line">   <span class="attr">name</span>: string</span><br><span class="line">   <span class="attr">age</span>: number</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 模拟请求接口返回的数据</span></span><br><span class="line"><span class="keyword">const</span> userList = [</span><br><span class="line">   &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;,</span><br><span class="line">   &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;李四&#x27;</span>, <span class="attr">age</span>: <span class="number">19</span> &#125;,</span><br><span class="line">]</span><br><span class="line"><span class="comment">// 封装模拟异步效果的定时器</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">wait</span>(<span class="params">delay: number</span>)&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(resolve, delay))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getUserList</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">   <span class="keyword">await</span> <span class="title function_">wait</span>(<span class="number">100</span>) <span class="comment">// 延迟100毫秒返回</span></span><br><span class="line">   <span class="keyword">return</span> userList</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后在 store&#x2F;user.ts 里的 actions 封装调用接口</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getUserList, userListType &#125; <span class="keyword">from</span> <span class="string">&#x27;../api/user&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> userStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line">   <span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="comment">// 用户列表</span></span><br><span class="line">            <span class="attr">list</span>: [] <span class="keyword">as</span> userListType <span class="comment">// 类型转换成 userListType</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">actions</span>: &#123;</span><br><span class="line">      <span class="keyword">async</span> <span class="title function_">loadUserList</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">const</span> list = <span class="keyword">await</span> <span class="title function_">getUserList</span>()</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">list</span> = list</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">3. 页面中调用 actions 发起请求</span><br><span class="line"></span><br><span class="line">   ```javascript</span><br><span class="line">   &lt;template&gt;</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">         &lt;li v-for=&quot;item in user_store.list&quot;&gt; ... &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">   &lt;/template&gt;</span><br><span class="line">   &lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">   import &#123; userStore &#125; from &#x27;../store&#x27;</span><br><span class="line">   const user_store = userStore()</span><br><span class="line">   user_store.loadUserList() // 加载所有数据</span><br><span class="line">   &lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="跨模块修改数据"><a href="#跨模块修改数据" class="headerlink" title="跨模块修改数据"></a>跨模块修改数据</h3><p>在一个模块的 actions 里需要修改另一个模块的 state 数据</p>
<p>示例：比如在 chat 模块里修改 user 模块里某个用户的名称</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// chat.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; userStore &#125; <span class="keyword">from</span> <span class="string">&quot;./user&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> chatStore = <span class="title function_">defineStore</span>(<span class="string">&quot;chat&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">someMethod</span>(<span class="params">userItem</span>) &#123;</span><br><span class="line">      userItem.<span class="property">name</span> = <span class="string">&quot;新的名字&quot;</span>;</span><br><span class="line">      <span class="keyword">const</span> user_store = <span class="title function_">userStore</span>();</span><br><span class="line">      user_store.<span class="title function_">updateUserName</span>(userItem);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>user 模块里</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// user.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> userStore = <span class="title function_">defineStore</span>(<span class="string">&quot;user&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">list</span>: [],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">updateUserName</span>(<span class="params">userItem</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> user = <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> === userItem.<span class="property">id</span>);</span><br><span class="line">      <span class="keyword">if</span> (user) &#123;</span><br><span class="line">        user.<span class="property">name</span> = userItem.<span class="property">name</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://Pikachu0315.github.io">Pikachu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://pikachu0315.github.io/2022/07/07/vue/Vue3/">https://pikachu0315.github.io/2022/07/07/vue/Vue3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://Pikachu0315.github.io" target="_blank">我不是皮卡丘i</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Vue3/">Vue3</a></div><div class="post_share"><div class="social-share" data-image="/img/md/v3.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="/pluginsSrc/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="/pluginsSrc/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/head_portrait.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Pikachu</div><div class="author-info__description">初次搭建，请多指教。</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Pikachu0315"><i class="fab fa-github"></i><span>Github</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="xpand" style="height:200px;"><canvas class="illo" width="800" height="800" style="max-width: 200px; max-height: 200px; touch-action: none; width: 640px; height: 640px;"></canvas></div><script src="https://fastly.jsdelivr.net/gh/xiaopengand/blogCdn@latest/xzxr/twopeople1.js"></script><script src="https://fastly.jsdelivr.net/gh/xiaopengand/blogCdn@latest/xzxr/zdog.dist.js"></script><script id="rendered-js" src="https://fastly.jsdelivr.net/gh/xiaopengand/blogCdn@latest/xzxr/twopeople.js"></script><style>.card-widget.card-announcement {
margin: 0;
align-items: center;
justify-content: center;
text-align: center;
}
canvas {
display: block;
margin: 0 auto;
cursor: move;
}</style><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#vue3-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">vue3 简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Vue3-%E5%B8%A6%E6%9D%A5%E4%BA%86%E4%BB%80%E4%B9%88"><span class="toc-number">2.</span> <span class="toc-text">Vue3 带来了什么</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-vue3-%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.</span> <span class="toc-text">创建 vue3 项目</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Options-API-%E7%9A%84%E5%BC%8A%E7%AB%AF"><span class="toc-number">4.</span> <span class="toc-text">Options API 的弊端</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86-Composition-API"><span class="toc-number">5.</span> <span class="toc-text">认识 Composition API</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#setup-%E5%87%BD%E6%95%B0%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">5.1.</span> <span class="toc-text">setup 函数的参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#setup-%E5%87%BD%E6%95%B0%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">5.2.</span> <span class="toc-text">setup 函数的返回值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%A6%E5%A4%96%E6%B3%A8%E6%84%8F%EF%BC%9Asetup-%E4%B8%8D%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8-this"><span class="toc-number">5.3.</span> <span class="toc-text">另外注意：setup 不可以使用 this</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86"><span class="toc-number">6.</span> <span class="toc-text">响应式原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Vue2"><span class="toc-number">6.1.</span> <span class="toc-text">Vue2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vue3"><span class="toc-number">6.2.</span> <span class="toc-text">Vue3</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#reactive-%E5%87%BD%E6%95%B0"><span class="toc-number">7.</span> <span class="toc-text">reactive 函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%8F%98%E6%88%90%E5%93%8D%E5%BA%94%E5%BC%8F%E7%9A%84%E5%91%A2%EF%BC%9F"><span class="toc-number">7.1.</span> <span class="toc-text">为什么就可以变成响应式的呢？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#reactive-%E5%88%A4%E6%96%AD%E7%9A%84-API"><span class="toc-number">7.2.</span> <span class="toc-text">reactive 判断的 API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#isProxy"><span class="toc-number">7.2.1.</span> <span class="toc-text">isProxy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#isReactive"><span class="toc-number">7.2.2.</span> <span class="toc-text">isReactive</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#isReadonly"><span class="toc-number">7.2.3.</span> <span class="toc-text">isReadonly</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#toRaw"><span class="toc-number">7.2.4.</span> <span class="toc-text">toRaw</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shallowReactive"><span class="toc-number">7.2.5.</span> <span class="toc-text">shallowReactive</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shallowReadonly"><span class="toc-number">7.2.6.</span> <span class="toc-text">shallowReadonly</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ref-%E5%87%BD%E6%95%B0"><span class="toc-number">8.</span> <span class="toc-text">ref 函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#toRefs"><span class="toc-number">8.1.</span> <span class="toc-text">toRefs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#toRef"><span class="toc-number">8.2.</span> <span class="toc-text">toRef</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ref-%E7%9A%84%E5%85%B6%E5%AE%83-API"><span class="toc-number">8.3.</span> <span class="toc-text">ref 的其它 API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#unref"><span class="toc-number">8.3.1.</span> <span class="toc-text">unref</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#isRef"><span class="toc-number">8.3.2.</span> <span class="toc-text">isRef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shallowRef"><span class="toc-number">8.3.3.</span> <span class="toc-text">shallowRef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#triggerRef"><span class="toc-number">8.3.4.</span> <span class="toc-text">triggerRef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shallowReactive-%E4%B8%8E-shallowRef-%E7%9A%84%E7%94%A8%E6%B3%95"><span class="toc-number">8.3.5.</span> <span class="toc-text">shallowReactive 与 shallowRef 的用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#customRef"><span class="toc-number">8.3.6.</span> <span class="toc-text">customRef</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ref-amp-reactive"><span class="toc-number">9.</span> <span class="toc-text">ref &amp; reactive</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#readonly"><span class="toc-number">10.</span> <span class="toc-text">readonly</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8%E5%BC%80%E5%8F%91%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84-readonly-%E6%96%B9%E6%B3%95%E4%BC%9A%E4%BC%A0%E5%85%A5%E4%B8%89%E4%B8%AA%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0%EF%BC%9A"><span class="toc-number">10.1.</span> <span class="toc-text">在开发中常见的 readonly 方法会传入三个类型的参数：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8-readonly-%E7%9A%84%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B%E4%B8%AD%EF%BC%8C%E6%9C%89%E5%A6%82%E4%B8%8B%E8%A7%84%E5%88%99%EF%BC%9A"><span class="toc-number">10.2.</span> <span class="toc-text">在 readonly 的使用过程中，有如下规则：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B6%E5%AE%83-Composition-API"><span class="toc-number">11.</span> <span class="toc-text">其它 Composition API</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#toRaw-amp-markRaw"><span class="toc-number">11.1.</span> <span class="toc-text">toRaw &amp; markRaw</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#provide-%E4%B8%8E-inject"><span class="toc-number">12.</span> <span class="toc-text">provide 与 inject</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7%E4%B8%8E%E7%9B%91%E8%A7%86"><span class="toc-number">13.</span> <span class="toc-text">计算属性与监视</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#computed"><span class="toc-number">13.1.</span> <span class="toc-text">computed</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#watch"><span class="toc-number">13.2.</span> <span class="toc-text">watch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#watchEffect"><span class="toc-number">13.3.</span> <span class="toc-text">watchEffect</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#watchEffect-%E5%81%9C%E6%AD%A2%E4%BE%A6%E5%90%AC"><span class="toc-number">13.4.</span> <span class="toc-text">watchEffect 停止侦听</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#watchEffect-%E6%B8%85%E9%99%A4%E5%89%AF%E4%BD%9C%E7%94%A8"><span class="toc-number">13.5.</span> <span class="toc-text">watchEffect 清除副作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#setup-%E4%B8%AD%E4%BD%BF%E7%94%A8-ref"><span class="toc-number">13.6.</span> <span class="toc-text">setup 中使用 ref</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#watchEffect-%E7%9A%84%E6%89%A7%E8%A1%8C%E6%97%B6%E6%9C%BA"><span class="toc-number">13.7.</span> <span class="toc-text">watchEffect 的执行时机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E6%95%B4-watchEffect-%E7%9A%84%E6%89%A7%E8%A1%8C%E6%97%B6%E6%9C%BA"><span class="toc-number">13.8.</span> <span class="toc-text">调整 watchEffect 的执行时机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#watch-%E5%87%BD%E6%95%B0%E6%80%BB%E7%BB%93"><span class="toc-number">13.9.</span> <span class="toc-text">watch 函数总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-number">14.</span> <span class="toc-text">生命周期函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-hook-%E5%87%BD%E6%95%B0"><span class="toc-number">15.</span> <span class="toc-text">自定义 hook 函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#useCounter"><span class="toc-number">15.1.</span> <span class="toc-text">useCounter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#useTitle"><span class="toc-number">15.2.</span> <span class="toc-text">useTitle</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#App-vue"><span class="toc-number">15.3.</span> <span class="toc-text">App.vue</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#setup-%E7%9A%84%E9%A1%B6%E5%B1%82%E7%BC%96%E5%86%99%E6%96%B9%E5%BC%8F"><span class="toc-number">16.</span> <span class="toc-text">setup 的顶层编写方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E7%BB%84%E4%BB%B6"><span class="toc-number">17.</span> <span class="toc-text">新增组件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Fragment"><span class="toc-number">17.1.</span> <span class="toc-text">Fragment</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Teleport"><span class="toc-number">17.2.</span> <span class="toc-text">Teleport</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Suspense"><span class="toc-number">17.3.</span> <span class="toc-text">Suspense</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%A8%E5%B1%80-API-%E7%9A%84%E8%BD%AC%E7%A7%BB"><span class="toc-number">18.</span> <span class="toc-text">全局 API 的转移</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E6%94%B9%E5%8F%98"><span class="toc-number">19.</span> <span class="toc-text">其它改变</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#h-%E5%87%BD%E6%95%B0"><span class="toc-number">20.</span> <span class="toc-text">h 函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%EF%BC%9F"><span class="toc-number">20.1.</span> <span class="toc-text">如何使用？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">20.2.</span> <span class="toc-text">实现计数器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93%E6%8F%92%E6%A7%BD"><span class="toc-number">20.3.</span> <span class="toc-text">渲染插槽</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jsx"><span class="toc-number">21.</span> <span class="toc-text">jsx</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E8%AE%A1%E6%95%B0%E5%99%A8-1"><span class="toc-number">21.1.</span> <span class="toc-text">实现计数器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8"><span class="toc-number">21.2.</span> <span class="toc-text">组件使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4"><span class="toc-number">22.</span> <span class="toc-text">自定义指令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%9A%E7%84%A6%E5%AE%9E%E7%8E%B0"><span class="toc-number">22.1.</span> <span class="toc-text">聚焦实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%80%E9%83%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4"><span class="toc-number">22.2.</span> <span class="toc-text">局部自定义指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4"><span class="toc-number">22.3.</span> <span class="toc-text">全局自定义指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">22.4.</span> <span class="toc-text">指令的生命周期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4%E7%9A%84%E5%8F%82%E6%95%B0%E5%92%8C%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-number">22.5.</span> <span class="toc-text">指令的参数和修饰符</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4%E7%BB%83%E4%B9%A0"><span class="toc-number">23.</span> <span class="toc-text">自定义指令练习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4%E6%A1%88%E4%BE%8B%EF%BC%9A%E6%97%B6%E9%97%B4%E6%88%B3%E7%9A%84%E6%98%BE%E7%A4%BA%E9%9C%80%E6%B1%82"><span class="toc-number">23.1.</span> <span class="toc-text">自定义指令案例：时间戳的显示需求</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#plugins"><span class="toc-number">24.</span> <span class="toc-text">plugins</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%86%99%E6%B3%95"><span class="toc-number">24.1.</span> <span class="toc-text">函数写法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%86%99%E6%B3%95"><span class="toc-number">24.2.</span> <span class="toc-text">对象写法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1"><span class="toc-number">25.</span> <span class="toc-text">路由</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Vuex"><span class="toc-number">26.</span> <span class="toc-text">Vuex</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Pinia"><span class="toc-number">27.</span> <span class="toc-text">Pinia</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%89-Vuex-%E4%BA%86%E8%BF%98%E8%A6%81%E5%86%8D%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA-Pinia-%EF%BC%9F"><span class="toc-number">27.1.</span> <span class="toc-text">为什么有 Vuex 了还要再开发一个 Pinia ？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pinia-%E7%89%B9%E6%80%A7"><span class="toc-number">27.2.</span> <span class="toc-text">Pinia 特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pinia-%E5%92%8C-Vuex"><span class="toc-number">27.3.</span> <span class="toc-text">Pinia 和 Vuex</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%8C%BA%E5%88%AB"><span class="toc-number">27.3.1.</span> <span class="toc-text">核心区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E6%94%AF%E6%8C%81"><span class="toc-number">27.3.2.</span> <span class="toc-text">版本支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">27.3.3.</span> <span class="toc-text">使用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pinia-%E4%BD%BF%E7%94%A8"><span class="toc-number">27.4.</span> <span class="toc-text">pinia 使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">27.4.1.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="toc-number">27.4.2.</span> <span class="toc-text">项目搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-pinia"><span class="toc-number">27.4.3.</span> <span class="toc-text">安装 pinia</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-pinia"><span class="toc-number">27.4.4.</span> <span class="toc-text">使用 pinia</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE-state"><span class="toc-number">27.4.5.</span> <span class="toc-text">访问 state</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getters"><span class="toc-number">27.4.6.</span> <span class="toc-text">getters</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#actions"><span class="toc-number">27.4.7.</span> <span class="toc-text">actions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%AF%E6%8C%81-VueDevtools"><span class="toc-number">27.4.8.</span> <span class="toc-text">支持 VueDevtools</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%A8%E6%A8%A1%E5%9D%97%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE"><span class="toc-number">27.4.9.</span> <span class="toc-text">跨模块修改数据</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/09/25/uniapp/uniapp/" title="uniapp"><img src="/img/md/uniapp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="uniapp"/></a><div class="content"><a class="title" href="/2022/09/25/uniapp/uniapp/" title="uniapp">uniapp</a><time datetime="2022-09-25T02:38:00.000Z" title="发表于 2022-09-25 10:38:00">2022-09-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/21/TypeScript/TypeScript/" title="TypeScript"><img src="/img/md/TypeScript.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TypeScript"/></a><div class="content"><a class="title" href="/2022/08/21/TypeScript/TypeScript/" title="TypeScript">TypeScript</a><time datetime="2022-08-21T02:38:41.000Z" title="发表于 2022-08-21 10:38:41">2022-08-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/07/React/React/" title="React"><img src="/img/md/react.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="React"/></a><div class="content"><a class="title" href="/2022/08/07/React/React/" title="React">React</a><time datetime="2022-08-07T02:38:41.000Z" title="发表于 2022-08-07 10:38:41">2022-08-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/27/nodeJS/nodejs/" title="nodeJs"><img src="/img/md/nodejs.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="nodeJs"/></a><div class="content"><a class="title" href="/2022/07/27/nodeJS/nodejs/" title="nodeJs">nodeJs</a><time datetime="2022-07-27T02:38:41.000Z" title="发表于 2022-07-27 10:38:41">2022-07-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/07/vue/Vue3/" title="Vue 3.0"><img src="/img/md/v3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue 3.0"/></a><div class="content"><a class="title" href="/2022/07/07/vue/Vue3/" title="Vue 3.0">Vue 3.0</a><time datetime="2022-07-07T09:38:41.000Z" title="发表于 2022-07-07 17:38:41">2022-07-07</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/md/v3.jpg')"><div id="footer-wrap"><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">I wish you to become your own sun, no need to rely on who's light.<p><a target="_blank" href="https://hexo.io/"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为Hexo"></a>&nbsp;<a target="_blank" href="https://butterfly.js.org/"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用butterfly"></a>&nbsp;<a target="_blank" href="https://www.jsdelivr.com/"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr" title="本站使用JsDelivr为静态资源提供CDN加速"></a> &nbsp;<a target="_blank" href="https://vercel.com/ "><img src="https://img.shields.io/badge/Hosted-Vervel-brightgreen?style=flat&logo=Vercel" title="本站采用双线部署，默认线路托管于Vercel"></a>&nbsp;<a target="_blank" href="https://vercel.com/ "><img src="https://img.shields.io/badge/Hosted-Coding-0cedbe?style=flat&logo=Codio" title="本站采用双线部署，联通线路托管于Coding"></a>&nbsp;<a target="_blank" href="https://github.com/"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由Gtihub托管"></a>&nbsp;<a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/pluginsSrc/@fancyapps/ui/dist/fancybox.umd.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000);</script><div class="js-pjax"></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/js/cat.js"></script><script src="/pluginsSrc/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="/pluginsSrc/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>